<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>e:\users\funfine\source\quiz\quiz\quizwebhookbot\controllers\updatecontroller.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Threading.Tasks;
using Microsoft.AspNetCore.Mvc;
using Microsoft.Extensions.Logging;
using QuizBotCore.Commands;
using QuizBotCore.Database;
using QuizRequestService;
using QuizWebHookBot.Services;
using Telegram.Bot.Types;
using Telegram.Bot.Types.Enums;

namespace QuizWebHookBot.Controllers
{
    [Route(&quot;api/[controller]&quot;)]
    public class UpdateController : Controller
    {
        private readonly IBotService botService;
        private readonly ServiceManager manager;
        private readonly IUpdateService updateService;

        public UpdateController(IUpdateService updateService, IBotService botService, ServiceManager manager)
        {
            this.updateService = updateService;
            this.botService = botService;
            this.manager = manager;
        }

        // POST api/update
        [HttpPost]
        public async Task&lt;IActionResult&gt; Post([FromBody] Update update)
        {
            Chat chat;
            switch (update.Type)
            {
                case UpdateType.Message:
                    chat = update.Message.Chat;
                    break;
                case UpdateType.CallbackQuery:
                    chat = update.CallbackQuery.Message.Chat;
                    await botService.Client.AnswerCallbackQueryAsync(update.CallbackQuery.Id);
                    break;
                default:
                    return Ok();
//                case UpdateType.ChannelPost:
//                    chat = update.ChannelPost.Chat;
//                    break;
//                case UpdateType.EditedMessage:
//                    chat = update.EditedMessage.Chat;
//                    break;
            }

//            await botService.Client.SendTextMessageAsync(chat.Id, update.Type.ToString());

            var userCommand = updateService.ProcessMessage(update);
            
            await userCommand.ExecuteAsync(chat, botService.Client, manager);
            
            return Ok();
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[20,9,20,110,0],[21,9,21,10,0],[22,13,22,48,0],[23,13,23,42,0],[24,13,24,36,0],[25,9,25,10,0],[30,9,30,10,0],[31,13,31,30,0],[32,13,32,33,0],[35,21,35,48,0],[36,21,36,27,0],[38,21,38,62,0],[39,21,39,95,0],[40,21,40,27,0],[42,21,42,33,0],[53,13,53,68,0],[55,13,55,78,0],[57,13,57,25,0],[58,9,58,10,0]]);
    </script>
  </body>
</html>