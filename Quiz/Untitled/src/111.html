<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>e:\users\funfine\source\quiz\quiz\database\mongohelpers.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Linq.Expressions;
using System.Reflection;
using MongoDB.Bson.Serialization;
using MongoDB.Bson.Serialization.Options;
using MongoDB.Bson.Serialization.Serializers;

namespace DataBase
{
    public static class MongoHelpers
    {
        public static BsonMemberMap MapDictionary&lt;TClass, TKey, TValue&gt;(
            this BsonClassMap&lt;TClass&gt; cm,
            Expression&lt;Func&lt;TClass, Dictionary&lt;TKey, TValue&gt;&gt;&gt; memberLambda) =&gt;
            cm.MapMember(memberLambda)
                .SetSerializer(new DictionaryInterfaceImplementerSerializer&lt;Dictionary&lt;TKey, TValue&gt;
                &gt;(DictionaryRepresentation.ArrayOfDocuments));

        public static void AutoRegisterClassMap&lt;TClass&gt;(Expression&lt;Func&lt;TClass, TClass&gt;&gt; creatorLambda) =&gt;
            AutoRegisterClassMap&lt;TClass&gt;(cm =&gt; cm.MapCreator(creatorLambda));

        public static void AutoRegisterClassMap&lt;T&gt;(Action&lt;BsonClassMap&lt;T&gt;&gt; additionalAction = null)
        {
            BsonClassMap.RegisterClassMap&lt;T&gt;(cm =&gt;
            {
                var propertyInfos = typeof(T)
                    .GetProperties(BindingFlags.DeclaredOnly |
                                   BindingFlags.Public |
                                   BindingFlags.Instance)
                    .Cast&lt;MemberInfo&gt;()
                    .ToList();
                foreach (var propertyInfo in propertyInfos)
                    cm.MapMember(propertyInfo);
                additionalAction?.Invoke(cm);
            });
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[17,13,19,62,0],[22,13,22,48,0],[22,48,22,76,0],[22,76,22,77,0],[22,13,22,77,0],[25,9,25,10,0],[26,13,27,13,0],[27,13,27,14,0],[27,14,28,17,0],[28,17,33,31,0],[33,31,34,17,0],[34,17,34,24,0],[34,24,34,26,0],[34,26,34,42,0],[34,42,34,43,0],[34,43,34,45,0],[34,45,34,46,0],[34,46,34,59,0],[34,59,35,21,0],[35,21,35,48,0],[35,48,36,17,0],[36,17,36,46,0],[36,46,37,13,0],[37,13,37,14,0],[37,14,37,16,0],[26,13,37,16,0],[38,9,38,10,0]]);
    </script>
  </body>
</html>