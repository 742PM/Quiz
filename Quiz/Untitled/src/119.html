<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>e:\users\funfine\source\quiz\quiz\quizrequestextendedservice\requester.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using Newtonsoft.Json;
using QuizRequestExtendedService.DTO;
using RestSharp;

namespace QuizRequestExtendedService
{
    public class Requester : IQuizServiceExtended
    {
        private readonly string serverUri;
        private const int MaxRetries = 5;

        public Requester(string serverUri)
        {
            this.serverUri = serverUri;
        }

        public IEnumerable&lt;TopicDTO&gt; GetTopics()
        {
            var client = new RestClient(serverUri + &quot;/api/topics&quot;);
            var content = SendGetRequest(client, Method.GET);
            var topics = JsonConvert.DeserializeObject&lt;List&lt;TopicDTO&gt;&gt;(content.Content);
            return topics;
        }

        public IEnumerable&lt;LevelDTO&gt; GetLevels(Guid topicId)
        {
            var client = new RestClient(serverUri + $&quot;/api/{topicId}/levels&quot;);
            var content = SendGetRequest(client, Method.GET);
            var levels = JsonConvert.DeserializeObject&lt;List&lt;LevelDTO&gt;&gt;(content.Content);
            return levels;
        }

        public IEnumerable&lt;AdminTemplateGeneratorDTO&gt; GetTemplateGenerators(Guid topicId, Guid levelId)
        {
            var client = new RestClient(serverUri + $&quot;/service/{topicId}/{levelId}/templateGenerators&quot;);
            var content = SendGetRequest(client, Method.GET);
            var templateGenerators = JsonConvert.DeserializeObject&lt;List&lt;AdminTemplateGeneratorDTO&gt;&gt;(content.Content);
            return templateGenerators;
        }

        public Guid AddEmptyTopic(EmptyTopicDTO topic)
        {
            var client = new RestClient(serverUri + $&quot;/service/topic&quot;);
            var request = new RestRequest(Method.POST);
            request.AddJsonBody(topic);
            var content = client.Execute(request);
            var topicId = JsonConvert.DeserializeObject&lt;Guid&gt;(content.Content);

            return topicId;
        }

        public Guid AddEmptyLevel(Guid topicId, EmptyLevelDTO level)
        {
            var client = new RestClient(serverUri + $&quot;/service/{topicId}/level&quot;);
            var request = new RestRequest(Method.POST);
            request.AddJsonBody(level);
            var content = client.Execute(request);
            var levelId = JsonConvert.DeserializeObject&lt;Guid&gt;(content.Content);

            return levelId;
        }

        public Guid AddEmptyGenerator(Guid topicId, Guid levelId, TemplateGeneratorDTO topic)
        {
            var client = new RestClient(serverUri + $&quot;/service/{topicId}/{levelId}/templateGenerator&quot;);
            var request = new RestRequest(Method.POST);
            request.AddJsonBody(topic);
            var content = client.Execute(request);
            var generatorId = JsonConvert.DeserializeObject&lt;Guid&gt;(content.Content);

            return generatorId;
        }

        public void DeleteTopic(Guid topicId)
        {
            var client = new RestClient(serverUri + $&quot;/service/topic/{topicId}&quot;);
            var request = new RestRequest(Method.DELETE);
            client.Execute(request);
        }

        public void DeleteLevel(Guid topicId, Guid levelId)
        {
            var client = new RestClient(serverUri + $&quot;/service/{topicId}/level/{levelId}&quot;);
            var request = new RestRequest(Method.DELETE);
            client.Execute(request);
        }

        public void DeleteTemplateGenerator(Guid topicId, Guid levelId, Guid generatorId)
        {
            var client = new RestClient(serverUri + $&quot;/service/{topicId}/{levelId}/generator/{generatorId}&quot;);
            var request = new RestRequest(Method.DELETE);
            client.Execute(request);
        }

        public TemplateGeneratorDTO RenderTask(TemplateGeneratorForRenderDTO templateGenerator)
        {
            var client = new RestClient(serverUri + $&quot;/templates/renderTask&quot;);
            var request = new RestRequest(Method.POST);
            request.AddJsonBody(templateGenerator);
            var content = client.Execute(request);
            var task = JsonConvert.DeserializeObject&lt;TemplateGeneratorDTO&gt;(content.Content);

            return task;
        }

        private IRestResponse SendGetRequest(IRestClient client, Method method, Parameter parameter = null)
        {
            var request = new RestRequest(method);
            if (parameter != null)
                request.AddParameter(parameter);
            for (var i = 0; i &lt; MaxRetries; i++)
            {
                var response = client.Execute(request);
                if (response.IsSuccessful)
                    return response;
            }

            return null;
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[14,9,14,43,0],[15,9,15,10,0],[16,13,16,40,0],[17,9,17,10,0],[20,9,20,10,0],[21,13,21,68,0],[22,13,22,62,0],[23,13,23,89,0],[24,13,24,27,0],[25,9,25,10,0],[28,9,28,10,0],[29,13,29,79,0],[30,13,30,62,0],[31,13,31,89,0],[32,13,32,27,0],[33,9,33,10,0],[36,9,36,10,0],[37,13,37,105,0],[38,13,38,62,0],[39,13,39,118,0],[40,13,40,39,0],[41,9,41,10,0],[44,9,44,10,0],[45,13,45,72,0],[46,13,46,56,0],[47,13,47,40,0],[48,13,48,51,0],[49,13,49,80,0],[51,13,51,28,0],[52,9,52,10,0],[55,9,55,10,0],[56,13,56,82,0],[57,13,57,56,0],[58,13,58,40,0],[59,13,59,51,0],[60,13,60,80,0],[62,13,62,28,0],[63,9,63,10,0],[66,9,66,10,0],[67,13,67,104,0],[68,13,68,56,0],[69,13,69,40,0],[70,13,70,51,0],[71,13,71,84,0],[73,13,73,32,0],[74,9,74,10,0],[77,9,77,10,0],[78,13,78,82,0],[79,13,79,58,0],[80,13,80,37,0],[81,9,81,10,0],[84,9,84,10,0],[85,13,85,92,0],[86,13,86,58,0],[87,13,87,37,0],[88,9,88,10,0],[91,9,91,10,0],[92,13,92,110,0],[93,13,93,58,0],[94,13,94,37,0],[95,9,95,10,0],[98,9,98,10,0],[99,13,99,77,0],[100,13,100,56,0],[101,13,101,52,0],[102,13,102,51,0],[103,13,103,93,0],[105,13,105,25,0],[106,9,106,10,0],[109,9,109,10,0],[110,13,110,51,0],[111,13,111,35,0],[112,17,112,49,0],[113,18,113,27,0],[113,29,113,43,0],[113,45,113,48,0],[114,13,114,14,0],[115,17,115,56,0],[116,17,116,43,0],[117,21,117,37,0],[118,13,118,14,0],[120,13,120,25,0],[121,9,121,10,0]]);
    </script>
  </body>
</html>