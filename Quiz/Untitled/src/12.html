<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>e:\users\funfine\source\quiz\quiz\complexityweb\services\quizservice\quizservicecontroller.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using Application.Exceptions;
using Application.QuizService;
using AutoMapper;
using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Mvc;
using QuizWebApp.Services.QuizService.DTO;

namespace QuizWebApp.Services.QuizService
{
    [Route(&quot;api&quot;)]
    [ApiController]
    public class QuizServiceController : ControllerBase
    {
        private readonly IQuizService applicationApi;

        public QuizServiceController(IQuizService applicationApi)
        {
            this.applicationApi = applicationApi;
        }

        /// &lt;summary&gt;
        ///     Возвращает список всех тем.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        ///     Sample request:
        ///     GET api/topics
        /// &lt;/remarks&gt;
        /// &lt;response code=&quot;200&quot;&gt; Возвращает список тем&lt;/response&gt;
        [HttpGet(&quot;topics&quot;)]
        public ActionResult&lt;IEnumerable&lt;TopicInfoDTO&gt;&gt; GetTopics()
        {
            var topics = applicationApi.GetTopicsInfo().Value;
            return Ok(topics.Select(Mapper.Map&lt;TopicInfoDTO&gt;));
        }

        /// &lt;summary&gt;
        ///     Возвращает всех список уровней в теме.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        ///     Sample request:
        ///     GET api/0/levels
        /// &lt;/remarks&gt;
        /// &lt;response code=&quot;200&quot;&gt; Возвращает список уровней в теме&lt;/response&gt;
        /// &lt;response code=&quot;404&quot;&gt; Id темы не найден&lt;/response&gt;
        [HttpGet(&quot;{topicId}/levels&quot;)]
        public ActionResult&lt;IEnumerable&lt;LevelInfoDTO&gt;&gt; GetLevels(Guid topicId)
        {
            var (isSuccess, _, levels, error) = applicationApi.GetLevels(topicId);
            if (isSuccess)
                return Ok(levels.Select(Mapper.Map&lt;LevelInfoDTO&gt;));
            return NotFound(error.Message);
        }

        /// &lt;summary&gt;
        ///     Возвращает список уровней в теме доступных пользователю.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        ///     Sample request:
        ///     GET api/0/0/availableLevels
        /// &lt;/remarks&gt;
        /// &lt;response code=&quot;200&quot;&gt; Возвращает список доступных уровней&lt;/response&gt;
        /// &lt;response code=&quot;404&quot;&gt; Id темы не найден&lt;/response&gt;
        [HttpGet(&quot;{userId}/{topicId}/availableLevels&quot;)]
        public ActionResult&lt;IEnumerable&lt;LevelInfoDTO&gt;&gt; GetAvailableLevels(Guid userId, Guid topicId)
        {
            var (isSuccess, _, availableLevels, error) = applicationApi.GetAvailableLevels(userId, topicId);
            if (isSuccess)
                return Ok(availableLevels.Select(Mapper.Map&lt;LevelInfoDTO&gt;));
            return NotFound(error.Message);
        }

        /// &lt;summary&gt;
        ///     Возвращает прогресс пользователя.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        ///     Sample request:
        ///     GET api/0/0/0/progress
        /// &lt;/remarks&gt;
        /// &lt;response code=&quot;200&quot;&gt; Возвращает прогресс пользователя&lt;/response&gt;
        /// &lt;response code=&quot;404&quot;&gt; Id темы или уровня не найдены&lt;/response&gt;
        [HttpGet(&quot;{userId}/{topicId}/{levelId}/progress&quot;)]
        public ActionResult&lt;LevelProgressInfoDTO&gt; GetProgress(Guid userId, Guid topicId, Guid levelId)
        {
            var (isSuccess, _, progress, error) = applicationApi.GetProgress(userId, topicId, levelId);
            if (isSuccess)
                return Ok(Mapper.Map&lt;LevelProgressInfoDTO&gt;(progress));
            switch (error)
            {
                case ArgumentException _:
                    return NotFound(error.Message);
                case AccessDeniedException _:
                    return Forbid();
                default:
                    return InternalServerError(error.Message);
            }
        }

        /// &lt;summary&gt;
        ///     Получить задачу.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        ///     Sample request:
        ///     GET api/1/1/1/task
        /// &lt;/remarks&gt;
        /// &lt;response code=&quot;200&quot;&gt; Возвращает задачу&lt;/response&gt;
        /// &lt;response code=&quot;404&quot;&gt; Id темы или уровня не найдены&lt;/response&gt;
        [HttpGet(&quot;{userId}/{topicId}/{levelId}/task&quot;)]
        public ActionResult&lt;TaskInfoDTO&gt; GetTaskInfo(Guid userId, Guid topicId, Guid levelId)
        {
            var (isSuccess, _, task, error) = applicationApi.GetTask(userId, topicId, levelId);
            if (isSuccess)
                return Ok(Mapper.Map&lt;TaskInfoDTO&gt;(task));
            switch (error)
            {
                case ArgumentException _:
                    return NotFound(error.Message);
                case AccessDeniedException _:
                    return Forbid();
                default:
                    return InternalServerError(error.Message);
            }
        }

        /// &lt;summary&gt;
        ///     Возвращает следующую задачу из текущих темы и уровня пользователя.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        ///     Sample request:
        ///     GET api/1/nextTask
        /// &lt;/remarks&gt;
        /// &lt;response code=&quot;200&quot;&gt; Возвращает следующую задачу&lt;/response&gt;
        /// &lt;response code=&quot;403&quot;&gt; Данная операция не доступна пользователю&lt;/response&gt;
        [HttpGet(&quot;{userId}/nextTask&quot;)]
        public ActionResult&lt;TaskInfoDTO&gt; GetNextTaskInfo(Guid userId)
        {
            var (isSuccess, _, task, error) = applicationApi.GetNextTask(userId);
            if (isSuccess)
                return Ok(Mapper.Map&lt;TaskInfoDTO&gt;(task));
            if (error is AccessDeniedException)
                return Forbid();
            return InternalServerError(error.Message);
        }

        /// &lt;summary&gt;
        ///     Возвращает подсказку на текущую задачу.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        ///     Sample request:
        ///     GET api/0/getHint
        /// &lt;/remarks&gt;
        /// &lt;response code=&quot;200&quot;&gt; Возвращает подсказку на текущую задачу&lt;/response&gt;
        /// &lt;response code=&quot;204&quot;&gt; Подсказки закончились&lt;/response&gt;
        /// &lt;response code=&quot;403&quot;&gt; Данная операция не доступна пользователю&lt;/response&gt;
        [HttpGet(&quot;{userId}/hint&quot;)]
        public ActionResult&lt;HintInfoDTO&gt; GetHint(Guid userId)
        {
            var (isSuccess, _, hint, error) = applicationApi.GetHint(userId);
            if (isSuccess)
                return Ok(Mapper.Map&lt;HintInfoDTO&gt;(hint));
            switch (error)
            {
                case AccessDeniedException _:
                    return Forbid();
                case OutOfHintsException _:
                    return NoContent();
                default:
                    return InternalServerError(error.Message);
            }
        }

        /// &lt;summary&gt;
        ///     Отправить ответ на сервер.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        ///     Sample request:
        ///     POST api/0/sendAnswer
        ///     &quot;O(1)&quot;
        /// &lt;/remarks&gt;
        /// &lt;response code=&quot;200&quot;&gt; Возвращает bool верный ли ответ&lt;/response&gt;
        /// &lt;response code=&quot;403&quot;&gt; Данная операция не доступна пользователю&lt;/response&gt;
        [HttpPost(&quot;{userId}/sendAnswer&quot;)]
        public ActionResult&lt;bool&gt; SendAnswer([FromBody] string answer, Guid userId)
        {
            var (isSuccess, _, result, error) = applicationApi.CheckAnswer(userId, answer);
            if (isSuccess)
                return Ok(result);
            if (error is AccessDeniedException)
                return Forbid();
            return InternalServerError(error.Message);
        }

        private ObjectResult InternalServerError(object value) =&gt;
            StatusCode(StatusCodes.Status500InternalServerError, value);
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[19,9,19,66,0],[20,9,20,10,0],[21,13,21,50,0],[22,9,22,10,0],[34,9,34,10,0],[35,13,35,63,0],[36,13,36,64,0],[37,9,37,10,0],[50,9,50,10,0],[51,13,51,83,0],[52,13,52,27,0],[53,17,53,68,0],[54,13,54,44,0],[55,9,55,10,0],[68,9,68,10,0],[69,13,69,109,0],[70,13,70,27,0],[71,17,71,77,0],[72,13,72,44,0],[73,9,73,10,0],[86,9,86,10,0],[87,13,87,104,0],[88,13,88,27,0],[89,17,89,71,0],[90,13,90,27,0],[93,21,93,52,0],[95,21,95,37,0],[97,21,97,63,0],[99,9,99,10,0],[112,9,112,10,0],[113,13,113,96,0],[114,13,114,27,0],[115,17,115,58,0],[116,13,116,27,0],[119,21,119,52,0],[121,21,121,37,0],[123,21,123,63,0],[125,9,125,10,0],[138,9,138,10,0],[139,13,139,82,0],[140,13,140,27,0],[141,17,141,58,0],[142,13,142,48,0],[143,17,143,33,0],[144,13,144,55,0],[145,9,145,10,0],[159,9,159,10,0],[160,13,160,78,0],[161,13,161,27,0],[162,17,162,58,0],[163,13,163,27,0],[166,21,166,37,0],[168,21,168,40,0],[170,21,170,63,0],[172,9,172,10,0],[186,9,186,10,0],[187,13,187,92,0],[188,13,188,27,0],[189,17,189,35,0],[190,13,190,48,0],[191,17,191,33,0],[192,13,192,55,0],[193,9,193,10,0],[196,13,196,72,0]]);
    </script>
  </body>
</html>