<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>e:\users\funfine\source\quiz\quiz\tests\templatetaskgenerator_should.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text.RegularExpressions;
using Domain.Entities.TaskGenerators;
using Domain.Values;
using FluentAssertions;
using NUnit.Framework;
using Scriban;
using static System.Guid;

namespace Tests
{
    [TestFixture]
    // ReSharper disable once InconsistentNaming
    public class TemplateTaskGenerator_Should
    {
        private const string CodeDummy = &quot;code&quot;;
        private const string QuestionDummy = &quot;code&quot;;
        private const string AnswerDummy = &quot;answer&quot;;
        private const int StreakDummy = 3;
        private const string RegexDummy = &quot;.*&quot;;
        private static readonly Guid IdDummy = Empty;
        private static readonly string[] ArrayDummy = new string[0];


        [Test]
        public void UseBodyFunction()
        {
            var actual = new TemplateTaskGenerator(IdDummy, ArrayDummy, &quot;{{get_loop_body iter1}}&quot;,ArrayDummy, AnswerDummy,
                    StreakDummy,
                    QuestionDummy)
                .GetTask(new Random());
            actual.Text.Should().NotBeEmpty();
            actual.Text.Length.Should().BeGreaterOrEqualTo(3);
        }

        private static void TestField(
            (string actual, string expected)? code = default,
            (string actual, string expected)? question = default,
            (string actual, string expected)? answer = default,
            (string[] actual, string[] expected)? answers = default,
            (string[] actual, string[] expected)? hints = default)
        {
            var (actualHints, expectedHints) = hints ?? (ArrayDummy, ArrayDummy);
            var (actualAnswers, expectedAnswers) = answers ?? (ArrayDummy, ArrayDummy);
            var (actualCode, expectedCode) = code ?? (CodeDummy, CodeDummy);
            var (actualAnswer, expectedAnswer) = answer ?? (AnswerDummy, AnswerDummy);
            var (actualQuestion, expectedQuestion) = question ?? (QuestionDummy, QuestionDummy);
            var expectation = new Task(expectedCode, expectedHints, expectedAnswer, IdDummy, expectedAnswers,
                                       expectedQuestion);
            var actual = new TemplateTaskGenerator(IdDummy, actualAnswers, actualCode, actualHints, actualAnswer,
                                                   StreakDummy,
                                                   actualQuestion)
                .GetTask(new Random());
            actual.Should().BeEquivalentTo(expectation);
        }

        private static void TestFieldWithRegex(
            (string actual, string regex)? code = default,
            (string actual, string regex)? question = default,
            (string actual, string regex)? answer = default,
            (string[] actual, string[] regexes)? answers = default,
            (string[] actual, string[] regexes)? hints = default)
        {
            var (actualHints, expectedHints) = hints ?? (ArrayDummy, ArrayDummy);
            var (actualAnswers, expectedAnswers) = answers ?? (ArrayDummy, ArrayDummy);
            var (actualCode, expectedCode) = code ?? (CodeDummy, RegexDummy);
            var (actualAnswer, expectedAnswer) = answer ?? (AnswerDummy, RegexDummy);
            var (actualQuestion, expectedQuestion) = question ?? (QuestionDummy, RegexDummy);

            var actual = new TemplateTaskGenerator(IdDummy, actualAnswers, actualCode, actualHints, actualAnswer,
                                                   StreakDummy,
                                                   actualQuestion)
                .GetTask(new Random());
            Regex.IsMatch(actual.Answer, expectedAnswer).Should().BeTrue();
            Regex.IsMatch(actual.Text, expectedCode).Should().BeTrue();
            Regex.IsMatch(actual.Question, expectedQuestion).Should().BeTrue();
            actual.PossibleAnswers.Zip(expectedAnswers, Regex.IsMatch).Should().AllBeEquivalentTo(true);
            actual.Hints.Zip(expectedHints, Regex.IsMatch).Should().AllBeEquivalentTo(true);
        }

        [TestCase(&quot;{{4+4}}&quot;, &quot;8&quot;)]
        public void RenderTemplate_InAnswer(string actual, string expected) =&gt; TestField(answer: (actual, expected));

        [TestCase(&quot;{{4+4}}&quot;, &quot;8&quot;)]
        public void RenderTemplate_InCode(string actual, string expected) =&gt; TestField((actual, expected));

        [TestCase(&quot;{{4+4}}&quot;, &quot;8&quot;)]
        public void RenderTemplate_InQuestion(string actual, string expected) =&gt;
            TestField(question: (actual, expected));

        [TestCase(&quot;{{any_of [&#39;m&#39;,&#39;n&#39;,&#39;k&#39;]}}&quot;, &quot;(n|m|k)&quot;, TestName = nameof(TemplateLanguage.AnyOf))]
        [TestCase(&quot;{{random 100 200}}&quot;, @&quot;\d{3}&quot;, TestName = nameof(TemplateLanguage.Random))]
        public void Render_WhenBuiltInFunctionsAreUsed(string actual, string regex) =&gt;
            TestFieldWithRegex((actual, regex));

        [TestCase(&quot;{{from1}}&quot;, @&quot;^-?\d{0,2}$&quot;, TestName = nameof(TemplateLanguage.From))]
        [TestCase(&quot;{{iter1}}&quot;, @&quot;[2,3,4,5,6,7,8]$&quot;, TestName = nameof(TemplateLanguage.IterateConstant))]
        [TestCase(&quot;{{loop_var2}}&quot;, @&quot;(i)|(j)|(k)|(x)|(y)|(step)&quot;, TestName = nameof(TemplateLanguage.LoopVariable))]
        [TestCase(&quot;{{to3}}&quot;, @&quot;^(n)|(m)|(length)|(size)|(amount)$&quot;, TestName = nameof(TemplateLanguage.To))]
        [TestCase(&quot;{{const5}}&quot;, @&quot;^-?\d{0,2}[^0]$&quot;, TestName = nameof(TemplateLanguage.Const))]
        public void Render_WhenBuiltInFieldsAreUsed(string actual, string regex) =&gt; TestFieldWithRegex((actual, regex));

        [TestCase(&quot;{{theta}}&quot;, TemplateLanguage.Theta)]
        [TestCase(&quot;{{sqrt}}&quot;, TemplateLanguage.Sqrt)]
        [TestCase(&quot;{{pow2}}&quot;, TemplateLanguage.Pow2)]
        [TestCase(&quot;{{pow3}}&quot;, TemplateLanguage.Pow3)]
        [TestCase(&quot;{{multiply}}&quot;, TemplateLanguage.Multiply)]
        [TestCase(&quot;{{theta_nlog_n}}&quot;, &quot;Θ(n ∙ log(n))&quot;)]
        //and so on;
        public void Render_Sugar(string actual, string expected) =&gt; TestField((actual, expected));
        

        [Test]
        public void CreateTemplatelessTasks() =&gt; TestField();

        [Test]
        public void RenderTemplate_InAnswers() =&gt; TestField(answers: (new[] { &quot;{{4+4}}&quot; }, new[] { &quot;8&quot; }));

        [Test]
        public void RenderTemplate_InHints() =&gt; TestField(hints: (new[] { &quot;{{4+4}}&quot; }, new[] { &quot;8&quot; }));

        [Test]
        public void RenderTemplates_WithSharedState() =&gt; TestField((&quot;{{var = 4; var}}&quot;, &quot;4&quot;),
                                                                   answer: (&quot;{{var}}&quot;, &quot;4&quot;), question: (&quot;{{var}}&quot;, &quot;4&quot;),
                                                                   hints: (new[] { &quot;{{var}}&quot; }, new[] { &quot;4&quot; }),
                                                                   answers: (new[] { &quot;{{var}}&quot; }, new[] { &quot;4&quot; }));

        [Test]
        public void Throw_WhenHintsAreNull()
        {
            Action nullHintsCreation = () =&gt;
                new TemplateTaskGenerator(IdDummy, null, CodeDummy, ArrayDummy, AnswerDummy, StreakDummy,
                                          QuestionDummy);

            nullHintsCreation.Should().Throw&lt;ArgumentException&gt;(&quot;hints can not be null&quot;);
        }

        [Test]
        public void Throw_WhenPossibleAnswersAreNull()
        {
            Action nullAnswersCreation = () =&gt;
                new TemplateTaskGenerator(IdDummy, ArrayDummy, CodeDummy, null, AnswerDummy, StreakDummy,
                                          QuestionDummy);
            nullAnswersCreation.Should().Throw&lt;ArgumentException&gt;(&quot;answers can not be null&quot;);
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[23,9,23,54,1],[24,9,24,69,1],[29,9,29,10,1],[30,13,33,40,1],[34,13,34,47,1],[35,13,35,63,1],[36,9,36,10,1],[44,9,44,10,1],[45,13,45,82,1],[46,13,46,88,1],[47,13,47,77,1],[48,13,48,87,1],[49,13,49,97,1],[50,13,51,58,1],[52,13,55,40,1],[56,13,56,57,1],[57,9,57,10,1],[65,9,65,10,1],[66,13,66,82,1],[67,13,67,88,1],[68,13,68,78,1],[69,13,69,86,1],[70,13,70,94,1],[72,13,75,40,1],[76,13,76,76,1],[77,13,77,72,1],[78,13,78,80,1],[79,13,79,105,1],[80,13,80,93,1],[81,9,81,10,1],[84,80,84,117,1],[87,78,87,107,1],[91,13,91,52,1],[96,13,96,48,1],[103,85,103,120,1],[112,69,112,98,1],[116,50,116,61,1],[119,51,119,107,1],[122,49,122,103,1],[125,58,128,114,1],[132,9,132,10,1],[133,13,134,17,1],[134,17,135,57,1],[135,57,135,58,1],[133,13,135,58,1],[137,13,137,90,1],[138,9,138,10,1],[142,9,142,10,1],[143,13,144,17,1],[144,17,145,57,1],[145,57,145,58,1],[143,13,145,58,1],[146,13,146,94,1],[147,9,147,10,1]]);
    </script>
  </body>
</html>