<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>e:\users\funfine\source\quiz\quiz\tests\mocks\testtaskrepository.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using Application.Repositories;
using Domain.Entities;
using Domain.Entities.TaskGenerators;

namespace Tests.Mocks
{
    public class TestTaskRepository : ITaskRepository
    {
        private readonly Dictionary&lt;Guid, Topic&gt; topics = new Dictionary&lt;Guid, Topic&gt;();

        public Topic[] GetTopics() =&gt; topics.Values.ToArray();

        public Level[] GetNextLevels(Guid topicId, Guid levelId)
        {
            return FindLevel(topicId, levelId)
                .NextLevels.Select(id =&gt; FindLevel(topicId, id))
                .ToArray();
        }

        public Level[] GetLevelsFromTopic(Guid topicId) =&gt;
            topics.TryGetValue(topicId, out var topic) ? topic.Levels : null;

        public TaskGenerator[] GetGeneratorsFromLevel(Guid topicId, Guid levelId)
        {
            return GetLevelsFromTopic(topicId)
                ?.FirstOrDefault(l =&gt; l.Id == levelId)
                ?.Generators;
        }

        public Topic InsertTopic(Topic topic) =&gt; UpdateTopic(topic);

        [Obsolete]
        void ITaskRepository.UpdateTopic(Topic topic)
        {
            throw new NotImplementedException();
        }

        public Topic UpdateTopic(Topic topic)
        {
            topics[topic.Id] = topic;
            return topic;
        }

        public Topic FindTopic(Guid topicId) =&gt; topics.TryGetValue(topicId, out var topic) ? topic : null;

        public Level InsertLevel(Guid topicId, Level level) =&gt; UpdateLevel(topicId, level);

        public Level UpdateLevel(Guid topicId, Level level)
        {
            var topic = topics[topicId];
            UpdateTopic(new Topic(
                topic.Id,
                topic.Name,
                topic.Description,
                topic.Levels
                    .Where(l =&gt; l.Id != level.Id)
                    .Concat(new[] { level })
                    .ToArray()));
            return level;
        }

        public Level FindLevel(Guid topicId, Guid levelId)
        {
            return GetLevelsFromTopic(topicId)?.FirstOrDefault(l =&gt; l.Id == levelId);
        }

        public TaskGenerator InsertGenerator(Guid topicId, Guid levelId, TaskGenerator entity) =&gt;
            UpdateGenerator(topicId, levelId, entity);

        [Obsolete]
        public ICollection&lt;TaskGenerator&gt; InsertGenerators(Guid topicId, Guid levelId, ICollection&lt;TaskGenerator&gt; entity)
        {
            throw new NotImplementedException();
        }

        public TaskGenerator UpdateGenerator(Guid topicId, Guid levelId, TaskGenerator entity)
        {
            var topic = topics[topicId];
            var level = FindLevel(topicId, levelId);
            UpdateTopic(new Topic(
                topic.Id,
                topic.Name,
                topic.Description,
                topic.Levels
                    .Where(l =&gt; l.Id != levelId)
                    .Concat(new[]
                    {
                        new Level(level.Id,
                            level.Description,
                            level.Generators
                                .Where(g =&gt; g.Id != entity.Id)
                                .Concat(new[] { entity })
                                .ToArray(),
                            level.NextLevels)
                    })
                    .ToArray()));
            return entity;
        }

        public TaskGenerator FindGenerator(Guid topicId, Guid levelId, Guid generatorId)
        {
            return FindLevel(topicId, levelId)?.Generators.FirstOrDefault(g =&gt; g.Id == generatorId);
        }

        [Obsolete]
        public void DeleteTopic(Guid topicId)
        {
            throw new NotImplementedException();
        }

        [Obsolete]
        public void DeleteLevel(Guid topicId, Guid levelId)
        {
            throw new NotImplementedException();
        }

        [Obsolete]
        public void DeleteGenerator(Guid topicId, Guid levelId, Guid generatorId)
        {
            throw new NotImplementedException();
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[12,9,12,89,1],[14,39,14,62,1],[17,9,17,10,0],[18,13,19,42,0],[19,42,19,64,0],[19,64,20,28,0],[18,13,20,28,0],[21,9,21,10,0],[24,13,24,77,1],[27,9,27,10,1],[28,13,29,39,1],[29,39,29,54,1],[29,54,30,30,1],[28,13,30,30,1],[31,9,31,10,1],[33,50,33,68,1],[37,9,37,10,0],[38,13,38,49,0],[42,9,42,10,1],[43,13,43,38,1],[44,13,44,26,1],[45,9,45,10,1],[47,49,47,106,1],[49,64,49,91,1],[52,9,52,10,1],[53,13,53,41,1],[54,13,59,33,1],[59,33,59,49,1],[59,49,61,34,1],[54,13,61,34,1],[62,13,62,26,1],[63,9,63,10,1],[66,9,66,10,1],[67,13,67,69,1],[67,69,67,84,1],[67,84,67,86,1],[67,13,67,86,1],[68,9,68,10,1],[71,13,71,54,0],[75,9,75,10,0],[76,13,76,49,0],[80,9,80,10,0],[81,13,81,41,0],[82,13,82,53,0],[83,13,88,33,0],[88,33,88,48,0],[88,48,94,45,0],[94,45,94,62,0],[94,62,99,34,0],[83,13,99,34,0],[100,13,100,27,0],[101,9,101,10,0],[104,9,104,10,1],[105,13,105,80,1],[105,80,105,99,1],[105,99,105,101,1],[105,13,105,101,1],[106,9,106,10,1],[110,9,110,10,0],[111,13,111,49,0],[116,9,116,10,0],[117,13,117,49,0],[122,9,122,10,0],[123,13,123,49,0]]);
    </script>
  </body>
</html>