<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>e:\users\funfine\source\quiz\quiz\quizrequestservice\requester.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Net;
using Newtonsoft.Json;
using QuizRequestService.DTO;
using RestSharp;

namespace QuizRequestService
{
    public class Requester : IQuizService
    {
        private readonly string serverUri;
        private const int MaxRetries = 5;

        public Requester(string serverUri)
        {
            this.serverUri = serverUri;
        }

        public IEnumerable&lt;TopicDTO&gt; GetTopics()
        {
            var client = new RestClient(serverUri + &quot;/api/topics&quot;);
            var content = SendGetRequest(client, Method.GET);
            var topics = JsonConvert.DeserializeObject&lt;List&lt;TopicDTO&gt;&gt;(content.Content);
            return topics;
        }

        public IEnumerable&lt;LevelDTO&gt; GetLevels(Guid topicId)
        {
            var client = new RestClient(serverUri + $&quot;/api/{topicId}/levels&quot;);
            var content = SendGetRequest(client, Method.GET);
            var levels = JsonConvert.DeserializeObject&lt;List&lt;LevelDTO&gt;&gt;(content.Content);
            return levels;
        }

        public IEnumerable&lt;LevelDTO&gt; GetAvailableLevels(Guid userId, Guid topicId)
        {
            var client = new RestClient(serverUri + $&quot;/api/{userId}/{topicId}/availableLevels&quot;);
            var request = SendGetRequest(client, Method.GET);
            if (request.StatusCode == HttpStatusCode.OK)
            {
                return JsonConvert.DeserializeObject&lt;List&lt;LevelDTO&gt;&gt;(request.Content);
            }
            return null;
        }

        public ProgressDTO GetProgress(Guid userId, Guid topicId, Guid levelId)
        {
            var client = new RestClient(serverUri + $&quot;/api/{userId}/{topicId}/{levelId}/progress&quot;);
            var request = SendGetRequest(client, Method.GET);
            if (request.StatusCode == HttpStatusCode.OK)
                return JsonConvert.DeserializeObject&lt;ProgressDTO&gt;(request.Content);
            return null;
        }

        public TaskDTO GetTaskInfo(Guid userId, Guid topicId, Guid levelId)
        {
            var client = new RestClient(serverUri + $&quot;/api/{userId}/{topicId}/{levelId}/task&quot;);
            var content = SendGetRequest(client, Method.GET);
            if (content.StatusCode == HttpStatusCode.OK)
                return JsonConvert.DeserializeObject&lt;TaskDTO&gt;(content.Content);
            return null;
        }

        public TaskDTO GetNextTaskInfo(Guid userId)
        {
            var client = new RestClient(serverUri + $&quot;/api/{userId}/nextTask&quot;);
            var content = SendGetRequest(client, Method.GET);
            if (content.StatusCode == HttpStatusCode.OK)
                return JsonConvert.DeserializeObject&lt;TaskDTO&gt;(content.Content);
            return null;
        }

        public HintDTO GetHint(Guid userId)
        {
            var client = new RestClient(serverUri + $&quot;/api/{userId}/hint&quot;);
            var request = SendGetRequest(client, Method.GET);
            if (request.StatusCode == HttpStatusCode.OK)
                return JsonConvert.DeserializeObject&lt;HintDTO&gt;(request.Content);
            return null;
        }

        public bool? SendAnswer(Guid userId, string answer)
        {
            var client = new RestClient(serverUri + $&quot;/api/{userId}/sendAnswer&quot;);
            var parameter = new Parameter(&quot;application/json&quot;, $&quot;\&quot;{answer}\&quot;&quot;, ParameterType.RequestBody);
            var request = SendGetRequest(client, Method.POST, parameter);
            if (request.StatusCode != HttpStatusCode.OK)
                return null;
            switch (request.Content)
            {
                case &quot;true&quot;:
                    return true;
                case &quot;false&quot;:
                    return false;
                default:
                    return null;
            }
        }

        private IRestResponse SendGetRequest(IRestClient client, Method method, Parameter parameter = null)
        {
            var request = new RestRequest(method);
            if (parameter != null)
                request.AddParameter(parameter);
            for (var i = 0; i &lt; MaxRetries; i++)
            {
                var response = client.Execute(request);
                if (response.IsSuccessful) 
                    return response;
            }
            return null;
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[15,9,15,43,0],[16,9,16,10,0],[17,13,17,40,0],[18,9,18,10,0],[21,9,21,10,0],[22,13,22,68,0],[23,13,23,62,0],[24,13,24,89,0],[25,13,25,27,0],[26,9,26,10,0],[29,9,29,10,0],[30,13,30,79,0],[31,13,31,62,0],[32,13,32,89,0],[33,13,33,27,0],[34,9,34,10,0],[37,9,37,10,0],[38,13,38,97,0],[39,13,39,62,0],[40,13,40,57,0],[41,13,41,14,0],[42,17,42,87,0],[44,13,44,25,0],[45,9,45,10,0],[48,9,48,10,0],[49,13,49,100,0],[50,13,50,62,0],[51,13,51,57,0],[52,17,52,84,0],[53,13,53,25,0],[54,9,54,10,0],[57,9,57,10,0],[58,13,58,96,0],[59,13,59,62,0],[60,13,60,57,0],[61,17,61,80,0],[62,13,62,25,0],[63,9,63,10,0],[66,9,66,10,0],[67,13,67,80,0],[68,13,68,62,0],[69,13,69,57,0],[70,17,70,80,0],[71,13,71,25,0],[72,9,72,10,0],[75,9,75,10,0],[76,13,76,76,0],[77,13,77,62,0],[78,13,78,57,0],[79,17,79,80,0],[80,13,80,25,0],[81,9,81,10,0],[84,9,84,10,0],[85,13,85,82,0],[86,13,86,107,0],[87,13,87,74,0],[88,13,88,57,0],[89,17,89,29,0],[90,13,90,37,0],[93,21,93,33,0],[95,21,95,34,0],[97,21,97,33,0],[99,9,99,10,0],[102,9,102,10,0],[103,13,103,51,0],[104,13,104,35,0],[105,17,105,49,0],[106,18,106,27,0],[106,29,106,43,0],[106,45,106,48,0],[107,13,107,14,0],[108,17,108,56,0],[109,17,109,43,0],[110,21,110,37,0],[111,13,111,14,0],[112,13,112,25,0],[113,9,113,10,0]]);
    </script>
  </body>
</html>