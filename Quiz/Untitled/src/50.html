<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>e:\users\funfine\source\quiz\quiz\infrastructure\result\asyncresultextensionsbothoperands.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Security.Cryptography;
using System.Threading.Tasks;

namespace Infrastructure.Result
{
    /// &lt;summary&gt;
    ///     Extentions for async operations where the task appears in the both operands
    /// &lt;/summary&gt;
    public static class AsyncResultExtensionsBothOperands
    {
        public static async Task&lt;Result&lt;K, E&gt;&gt; OnSuccess&lt;T, K, E&gt;(
            this Task&lt;Result&lt;T, E&gt;&gt; resultTask,
            Func&lt;T, Task&lt;K&gt;&gt; func) where E : Exception
        {
            var result = await resultTask.ConfigureAwait(Result.DefaultConfigureAwait);

            if (result.IsFailure)
                return Result.Fail&lt;K, E&gt;(result.Error);

            var value = await func(result.Value)
                            .ConfigureAwait(Result.DefaultConfigureAwait);

            return Result.Ok&lt;K, E&gt;(value);
        }

        public static async Task&lt;Result&lt;K&gt;&gt; OnSuccess&lt;T, K&gt;(this Task&lt;Result&lt;T&gt;&gt; resultTask, Func&lt;T, Task&lt;K&gt;&gt; func)
        {
            var result = await resultTask.ConfigureAwait(Result.DefaultConfigureAwait);

            if (result.IsFailure)
                return Result.Fail&lt;K&gt;(result.Error);

            var value = await func(result.Value)
                            .ConfigureAwait(Result.DefaultConfigureAwait);

            return Result.Ok(value);
        }

        public static async Task&lt;Result&lt;T&gt;&gt; OnSuccess&lt;T&gt;(this Task&lt;Result&gt; resultTask, Func&lt;Task&lt;T&gt;&gt; func)
        {
            var result = await resultTask.ConfigureAwait(Result.DefaultConfigureAwait);

            if (result.IsFailure)
                return Result.Fail&lt;T&gt;(result.Error);

            var value = await func()
                            .ConfigureAwait(Result.DefaultConfigureAwait);

            return Result.Ok(value);
        }

        public static async Task&lt;Result&lt;K, E&gt;&gt; OnSuccess&lt;T, K, E&gt;(
            this Task&lt;Result&lt;T, E&gt;&gt; resultTask,
            Func&lt;T, Task&lt;Result&lt;K, E&gt;&gt;&gt; func) where E : Exception
        {
            var result = await resultTask.ConfigureAwait(Result.DefaultConfigureAwait);

            if (result.IsFailure)
                return Result.Fail&lt;K, E&gt;(result.Error);

            return await func(result.Value)
                       .ConfigureAwait(Result.DefaultConfigureAwait);
        }

        public static async Task&lt;Result&lt;K&gt;&gt; OnSuccess&lt;T, K&gt;(
            this Task&lt;Result&lt;T&gt;&gt; resultTask,
            Func&lt;T, Task&lt;Result&lt;K&gt;&gt;&gt; func)
        {
            var result = await resultTask.ConfigureAwait(Result.DefaultConfigureAwait);

            if (result.IsFailure)
                return Result.Fail&lt;K&gt;(result.Error);

            return await func(result.Value)
                       .ConfigureAwait(Result.DefaultConfigureAwait);
        }

        public static async Task&lt;Result&lt;T&gt;&gt; OnSuccess&lt;T&gt;(this Task&lt;Result&gt; resultTask, Func&lt;Task&lt;Result&lt;T&gt;&gt;&gt; func)
        {
            var result = await resultTask.ConfigureAwait(Result.DefaultConfigureAwait);

            if (result.IsFailure)
                return Result.Fail&lt;T&gt;(result.Error);

            return await func()
                       .ConfigureAwait(Result.DefaultConfigureAwait);
        }

        public static async Task&lt;Result&lt;K, E&gt;&gt; OnSuccess&lt;T, K, E&gt;(
            this Task&lt;Result&lt;T, E&gt;&gt; resultTask,
            Func&lt;Task&lt;Result&lt;K, E&gt;&gt;&gt; func) where E : Exception
        {
            var result = await resultTask.ConfigureAwait(Result.DefaultConfigureAwait);

            if (result.IsFailure)
                return Result.Fail&lt;K, E&gt;(result.Error);

            return await func()
                       .ConfigureAwait(Result.DefaultConfigureAwait);
        }

        public static async Task&lt;Result&lt;K&gt;&gt; OnSuccess&lt;T, K&gt;(this Task&lt;Result&lt;T&gt;&gt; resultTask, Func&lt;Task&lt;Result&lt;K&gt;&gt;&gt; func)
        {
            var result = await resultTask.ConfigureAwait(Result.DefaultConfigureAwait);

            if (result.IsFailure)
                return Result.Fail&lt;K&gt;(result.Error);

            return await func()
                       .ConfigureAwait(Result.DefaultConfigureAwait);
        }

        public static async Task&lt;Result&gt; OnSuccess&lt;T&gt;(this Task&lt;Result&lt;T&gt;&gt; resultTask, Func&lt;T, Task&lt;Result&gt;&gt; func)
        {
            var result = await resultTask.ConfigureAwait(Result.DefaultConfigureAwait);

            if (result.IsFailure)
                return Result.Fail(result.Error);

            return await func(result.Value)
                       .ConfigureAwait(Result.DefaultConfigureAwait);
        }

        public static async Task&lt;Result&gt; OnSuccess(this Task&lt;Result&gt; resultTask, Func&lt;Task&lt;Result&gt;&gt; func)
        {
            var result = await resultTask.ConfigureAwait(Result.DefaultConfigureAwait);

            if (result.IsFailure)
                return result;

            return await func()
                       .ConfigureAwait(Result.DefaultConfigureAwait);
        }

        public static async Task&lt;Result&lt;T&gt;&gt; Ensure&lt;T&gt;(
            this Task&lt;Result&lt;T&gt;&gt; resultTask,
            Func&lt;T, Task&lt;bool&gt;&gt; predicate,
            string errorMessage)
        {
            var result = await resultTask.ConfigureAwait(Result.DefaultConfigureAwait);

            if (result.IsFailure)
                return result;

            if (!await predicate(result.Value)
                     .ConfigureAwait(Result.DefaultConfigureAwait))
                return Result.Fail&lt;T&gt;(errorMessage);

            return result;
        }

        public static async Task&lt;Result&lt;T, E&gt;&gt; Ensure&lt;T, E&gt;(
            this Task&lt;Result&lt;T, E&gt;&gt; resultTask,
            Func&lt;T, Task&lt;bool&gt;&gt; predicate,
            E error) where E : Exception
        {
            var result = await resultTask.ConfigureAwait(Result.DefaultConfigureAwait);

            if (result.IsFailure)
                return result;

            if (!await predicate(result.Value)
                     .ConfigureAwait(Result.DefaultConfigureAwait))
                return Result.Fail&lt;T, E&gt;(error);

            return result;
        }

        public static async Task&lt;Result&gt; Ensure(
            this Task&lt;Result&gt; resultTask,
            Func&lt;Task&lt;bool&gt;&gt; predicate,
            string errorMessage)
        {
            var result = await resultTask.ConfigureAwait(Result.DefaultConfigureAwait);

            if (result.IsFailure)
                return result;

            if (!await predicate()
                     .ConfigureAwait(Result.DefaultConfigureAwait))
                return Result.Fail(errorMessage);

            return result;
        }

        public static Task&lt;Result&lt;K, E&gt;&gt; Map&lt;T, K, E&gt;(this Task&lt;Result&lt;T, E&gt;&gt; resultTask, Func&lt;T, Task&lt;K&gt;&gt; func)
            where E : Exception =&gt;
            resultTask.OnSuccess(func);

        public static Task&lt;Result&lt;K&gt;&gt; Map&lt;T, K&gt;(this Task&lt;Result&lt;T&gt;&gt; resultTask, Func&lt;T, Task&lt;K&gt;&gt; func) =&gt;
            resultTask.OnSuccess(func);

        public static Task&lt;Result&lt;T&gt;&gt; Map&lt;T&gt;(this Task&lt;Result&gt; resultTask, Func&lt;Task&lt;T&gt;&gt; func) =&gt;
            resultTask.OnSuccess(func);

        public static async Task&lt;Result&lt;T, E&gt;&gt; OnSuccess&lt;T, E&gt;(this Task&lt;Result&lt;T, E&gt;&gt; resultTask, Func&lt;T, Task&gt; action) where E : Exception
        {
            var result = await resultTask.ConfigureAwait(Result.DefaultConfigureAwait);

            if (result.IsSuccess)
                await action(result.Value)
                    .ConfigureAwait(Result.DefaultConfigureAwait);

            return result;
        }

        public static async Task&lt;Result&lt;T&gt;&gt; OnSuccess&lt;T&gt;(this Task&lt;Result&lt;T&gt;&gt; resultTask, Func&lt;T, Task&gt; action)
        {
            var result = await resultTask.ConfigureAwait(Result.DefaultConfigureAwait);

            if (result.IsSuccess)
                await action(result.Value)
                    .ConfigureAwait(Result.DefaultConfigureAwait);

            return result;
        }

        public static async Task&lt;Result&gt; OnSuccess(this Task&lt;Result&gt; resultTask, Func&lt;Task&gt; action)
        {
            var result = await resultTask.ConfigureAwait(Result.DefaultConfigureAwait);

            if (result.IsSuccess)
                await action()
                    .ConfigureAwait(Result.DefaultConfigureAwait);

            return result;
        }

        public static async Task&lt;T&gt; OnBoth&lt;T&gt;(this Task&lt;Result&gt; resultTask, Func&lt;Result, Task&lt;T&gt;&gt; func)
        {
            var result = await resultTask.ConfigureAwait(Result.DefaultConfigureAwait);
            return await func(result)
                       .ConfigureAwait(Result.DefaultConfigureAwait);
        }

        public static async Task&lt;K&gt; OnBoth&lt;T, K&gt;(this Task&lt;Result&lt;T&gt;&gt; resultTask, Func&lt;Result&lt;T&gt;, Task&lt;K&gt;&gt; func)
        {
            var result = await resultTask.ConfigureAwait(Result.DefaultConfigureAwait);
            return await func(result)
                       .ConfigureAwait(Result.DefaultConfigureAwait);
        }

        public static async Task&lt;K&gt; OnBoth&lt;T, K, E&gt;(
            this Task&lt;Result&lt;T, E&gt;&gt; resultTask,
            Func&lt;Result&lt;T, E&gt;, Task&lt;K&gt;&gt; func) where E : Exception
        {
            var result = await resultTask.ConfigureAwait(Result.DefaultConfigureAwait);
            return await func(result)
                       .ConfigureAwait(Result.DefaultConfigureAwait);
        }

        public static async Task&lt;Result&lt;T, E&gt;&gt; OnFailure&lt;T, E&gt;(this Task&lt;Result&lt;T, E&gt;&gt; resultTask, Func&lt;Task&gt; func) where E : Exception
        {
            var result = await resultTask.ConfigureAwait(Result.DefaultConfigureAwait);

            if (result.IsFailure)
                await func()
                    .ConfigureAwait(Result.DefaultConfigureAwait);

            return result;
        }

        public static async Task&lt;Result&lt;T&gt;&gt; OnFailure&lt;T&gt;(this Task&lt;Result&lt;T&gt;&gt; resultTask, Func&lt;Task&gt; func)
        {
            var result = await resultTask.ConfigureAwait(Result.DefaultConfigureAwait);

            if (result.IsFailure)
                await func()
                    .ConfigureAwait(Result.DefaultConfigureAwait);

            return result;
        }

        public static async Task&lt;Result&gt; OnFailure(this Task&lt;Result&gt; resultTask, Func&lt;Task&gt; func)
        {
            var result = await resultTask.ConfigureAwait(Result.DefaultConfigureAwait);

            if (result.IsFailure)
                await func()
                    .ConfigureAwait(Result.DefaultConfigureAwait);

            return result;
        }

        public static async Task&lt;Result&lt;T&gt;&gt; OnFailure&lt;T&gt;(this Task&lt;Result&lt;T&gt;&gt; resultTask, Func&lt;string, Task&gt; func)
        {
            var result = await resultTask.ConfigureAwait(Result.DefaultConfigureAwait);

            if (result.IsFailure)
                await func(result.Error)
                    .ConfigureAwait(Result.DefaultConfigureAwait);

            return result;
        }

        public static async Task&lt;Result&lt;T, E&gt;&gt; OnFailure&lt;T, E&gt;(this Task&lt;Result&lt;T, E&gt;&gt; resultTask, Func&lt;E, Task&gt; func) where E : Exception
        {
            var result = await resultTask.ConfigureAwait(Result.DefaultConfigureAwait);

            if (result.IsFailure)
                await func(result.Error)
                    .ConfigureAwait(Result.DefaultConfigureAwait);

            return result;
        }

        public static async Task&lt;Result&lt;T, E&gt;&gt; OnFailureCompensate&lt;T, E&gt;(
            this Task&lt;Result&lt;T, E&gt;&gt; resultTask,
            Func&lt;Task&lt;Result&lt;T, E&gt;&gt;&gt; func) where E : Exception
        {
            var result = await resultTask.ConfigureAwait(Result.DefaultConfigureAwait);

            if (result.IsFailure)
                return await func()
                           .ConfigureAwait(Result.DefaultConfigureAwait);

            return result;
        }

        public static async Task&lt;Result&lt;T&gt;&gt; OnFailureCompensate&lt;T&gt;(
            this Task&lt;Result&lt;T&gt;&gt; resultTask,
            Func&lt;Task&lt;Result&lt;T&gt;&gt;&gt; func)
        {
            var result = await resultTask.ConfigureAwait(Result.DefaultConfigureAwait);

            if (result.IsFailure)
                return await func()
                           .ConfigureAwait(Result.DefaultConfigureAwait);

            return result;
        }

        public static async Task&lt;Result&gt; OnFailureCompensate(this Task&lt;Result&gt; resultTask, Func&lt;Task&lt;Result&gt;&gt; func)
        {
            var result = await resultTask.ConfigureAwait(Result.DefaultConfigureAwait);

            if (result.IsFailure)
                return await func()
                           .ConfigureAwait(Result.DefaultConfigureAwait);

            return result;
        }

        public static async Task&lt;Result&lt;T&gt;&gt; OnFailureCompensate&lt;T&gt;(
            this Task&lt;Result&lt;T&gt;&gt; resultTask,
            Func&lt;string, Task&lt;Result&lt;T&gt;&gt;&gt; func)
        {
            var result = await resultTask.ConfigureAwait(Result.DefaultConfigureAwait);

            if (result.IsFailure)
                return await func(result.Error)
                           .ConfigureAwait(Result.DefaultConfigureAwait);

            return result;
        }

        public static async Task&lt;Result&lt;T, E&gt;&gt; OnFailureCompensate&lt;T, E&gt;(
            this Task&lt;Result&lt;T, E&gt;&gt; resultTask,
            Func&lt;E, Task&lt;Result&lt;T, E&gt;&gt;&gt; func) where E : Exception
        {
            var result = await resultTask.ConfigureAwait(Result.DefaultConfigureAwait);

            if (result.IsFailure)
                return await func(result.Error)
                           .ConfigureAwait(Result.DefaultConfigureAwait);

            return result;
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[15,9,15,10,0],[16,13,16,88,0],[18,13,18,34,0],[19,17,19,56,0],[21,13,22,75,0],[24,13,24,43,0],[25,9,25,10,0],[28,9,28,10,0],[29,13,29,88,0],[31,13,31,34,0],[32,17,32,53,0],[34,13,35,75,0],[37,13,37,37,0],[38,9,38,10,0],[41,9,41,10,0],[42,13,42,88,0],[44,13,44,34,0],[45,17,45,53,0],[47,13,48,75,0],[50,13,50,37,0],[51,9,51,10,0],[56,9,56,10,0],[57,13,57,88,0],[59,13,59,34,0],[60,17,60,56,0],[62,13,63,70,0],[64,9,64,10,0],[69,9,69,10,0],[70,13,70,88,0],[72,13,72,34,0],[73,17,73,53,0],[75,13,76,70,0],[77,9,77,10,0],[80,9,80,10,0],[81,13,81,88,0],[83,13,83,34,0],[84,17,84,53,0],[86,13,87,70,0],[88,9,88,10,0],[93,9,93,10,0],[94,13,94,88,0],[96,13,96,34,0],[97,17,97,56,0],[99,13,100,70,0],[101,9,101,10,0],[104,9,104,10,0],[105,13,105,88,0],[107,13,107,34,0],[108,17,108,53,0],[110,13,111,70,0],[112,9,112,10,0],[115,9,115,10,0],[116,13,116,88,0],[118,13,118,34,0],[119,17,119,50,0],[121,13,122,70,0],[123,9,123,10,0],[126,9,126,10,0],[127,13,127,88,0],[129,13,129,34,0],[130,17,130,31,0],[132,13,133,70,0],[134,9,134,10,0],[140,9,140,10,0],[141,13,141,88,0],[143,13,143,34,0],[144,17,144,31,0],[146,13,147,68,0],[148,17,148,53,0],[150,13,150,27,0],[151,9,151,10,0],[157,9,157,10,0],[158,13,158,88,0],[160,13,160,34,0],[161,17,161,31,0],[163,13,164,68,0],[165,17,165,49,0],[167,13,167,27,0],[168,9,168,10,0],[174,9,174,10,0],[175,13,175,88,0],[177,13,177,34,0],[178,17,178,31,0],[180,13,181,68,0],[182,17,182,50,0],[184,13,184,27,0],[185,9,185,10,0],[189,13,189,39,0],[192,13,192,39,0],[195,13,195,39,0],[198,9,198,10,0],[199,13,199,88,0],[201,13,201,34,0],[202,17,203,67,0],[205,13,205,27,0],[206,9,206,10,0],[209,9,209,10,0],[210,13,210,88,0],[212,13,212,34,0],[213,17,214,67,0],[216,13,216,27,0],[217,9,217,10,0],[220,9,220,10,0],[221,13,221,88,0],[223,13,223,34,0],[224,17,225,67,0],[227,13,227,27,0],[228,9,228,10,0],[231,9,231,10,0],[232,13,232,88,0],[233,13,234,70,0],[235,9,235,10,0],[238,9,238,10,0],[239,13,239,88,0],[240,13,241,70,0],[242,9,242,10,0],[247,9,247,10,0],[248,13,248,88,0],[249,13,250,70,0],[251,9,251,10,0],[254,9,254,10,0],[255,13,255,88,0],[257,13,257,34,0],[258,17,259,67,0],[261,13,261,27,0],[262,9,262,10,0],[265,9,265,10,0],[266,13,266,88,0],[268,13,268,34,0],[269,17,270,67,0],[272,13,272,27,0],[273,9,273,10,0],[276,9,276,10,0],[277,13,277,88,0],[279,13,279,34,0],[280,17,281,67,0],[283,13,283,27,0],[284,9,284,10,0],[287,9,287,10,0],[288,13,288,88,0],[290,13,290,34,0],[291,17,292,67,0],[294,13,294,27,0],[295,9,295,10,0],[298,9,298,10,0],[299,13,299,88,0],[301,13,301,34,0],[302,17,303,67,0],[305,13,305,27,0],[306,9,306,10,0],[311,9,311,10,0],[312,13,312,88,0],[314,13,314,34,0],[315,17,316,74,0],[318,13,318,27,0],[319,9,319,10,0],[324,9,324,10,0],[325,13,325,88,0],[327,13,327,34,0],[328,17,329,74,0],[331,13,331,27,0],[332,9,332,10,0],[335,9,335,10,0],[336,13,336,88,0],[338,13,338,34,0],[339,17,340,74,0],[342,13,342,27,0],[343,9,343,10,0],[348,9,348,10,0],[349,13,349,88,0],[351,13,351,34,0],[352,17,353,74,0],[355,13,355,27,0],[356,9,356,10,0],[361,9,361,10,0],[362,13,362,88,0],[364,13,364,34,0],[365,17,366,74,0],[368,13,368,27,0],[369,9,369,10,0]]);
    </script>
  </body>
</html>