<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>e:\users\funfine\source\quiz\quiz\infrastructure\result\asyncresultextensionsrightoperand.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Threading.Tasks;

namespace Infrastructure.Result
{
    /// &lt;summary&gt;
    ///     Extentions for async operations where the task appears in the right operand only
    /// &lt;/summary&gt;
    public static class AsyncResultExtensionsRightOperand
    {
        public static async Task&lt;Result&lt;K&gt;&gt; OnSuccess&lt;T, K&gt;(this Result&lt;T&gt; result, Func&lt;T, Task&lt;K&gt;&gt; func)
        {
            if (result.IsFailure)
                return Result.Fail&lt;K&gt;(result.Error);

            var value = await func(result.Value)
                            .ConfigureAwait(Result.DefaultConfigureAwait);

            return Result.Ok(value);
        }

        public static async Task&lt;Result&lt;K, E&gt;&gt; OnSuccess&lt;T, K, E&gt;(this Result&lt;T, E&gt; result, Func&lt;T, Task&lt;K&gt;&gt; func)
            where E : Exception
        {
            if (result.IsFailure)
                return Result.Fail&lt;K, E&gt;(result.Error);

            var value = await func(result.Value)
                            .ConfigureAwait(Result.DefaultConfigureAwait);

            return Result.Ok&lt;K, E&gt;(value);
        }

        public static async Task&lt;Result&lt;T&gt;&gt; OnSuccess&lt;T&gt;(this Result result, Func&lt;Task&lt;T&gt;&gt; func)
        {
            if (result.IsFailure)
                return Result.Fail&lt;T&gt;(result.Error);

            var value = await func()
                            .ConfigureAwait(Result.DefaultConfigureAwait);

            return Result.Ok(value);
        }

        public static async Task&lt;Result&lt;K&gt;&gt; OnSuccess&lt;T, K&gt;(this Result&lt;T&gt; result, Func&lt;T, Task&lt;Result&lt;K&gt;&gt;&gt; func)
        {
            if (result.IsFailure)
                return Result.Fail&lt;K&gt;(result.Error);

            return await func(result.Value)
                       .ConfigureAwait(Result.DefaultConfigureAwait);
        }

        public static async Task&lt;Result&lt;K, E&gt;&gt; OnSuccess&lt;T, K, E&gt;(
            this Result&lt;T, E&gt; result,
            Func&lt;T, Task&lt;Result&lt;K, E&gt;&gt;&gt; func) where E : Exception
        {
            if (result.IsFailure)
                return Result.Fail&lt;K, E&gt;(result.Error);

            return await func(result.Value)
                       .ConfigureAwait(Result.DefaultConfigureAwait);
        }

        public static async Task&lt;Result&lt;T&gt;&gt; OnSuccess&lt;T&gt;(this Result result, Func&lt;Task&lt;Result&lt;T&gt;&gt;&gt; func)
        {
            if (result.IsFailure)
                return Result.Fail&lt;T&gt;(result.Error);

            return await func()
                       .ConfigureAwait(Result.DefaultConfigureAwait);
        }

        public static async Task&lt;Result&lt;K&gt;&gt; OnSuccess&lt;T, K&gt;(this Result&lt;T&gt; result, Func&lt;Task&lt;Result&lt;K&gt;&gt;&gt; func)
        {
            if (result.IsFailure)
                return Result.Fail&lt;K&gt;(result.Error);

            return await func()
                       .ConfigureAwait(Result.DefaultConfigureAwait);
        }

        public static async Task&lt;Result&lt;K, E&gt;&gt; OnSuccess&lt;T, K, E&gt;(
            this Result&lt;T, E&gt; result,
            Func&lt;Task&lt;Result&lt;K, E&gt;&gt;&gt; func) where E : Exception
        {
            if (result.IsFailure)
                return Result.Fail&lt;K, E&gt;(result.Error);

            return await func()
                       .ConfigureAwait(Result.DefaultConfigureAwait);
        }

        public static async Task&lt;Result&gt; OnSuccess&lt;T&gt;(this Result&lt;T&gt; result, Func&lt;T, Task&lt;Result&gt;&gt; func)
        {
            if (result.IsFailure)
                return Result.Fail(result.Error);

            return await func(result.Value)
                       .ConfigureAwait(Result.DefaultConfigureAwait);
        }

        public static async Task&lt;Result&gt; OnSuccess(this Result result, Func&lt;Task&lt;Result&gt;&gt; func)
        {
            if (result.IsFailure)
                return result;

            return await func()
                       .ConfigureAwait(Result.DefaultConfigureAwait);
        }

        public static async Task&lt;Result&lt;T&gt;&gt; Ensure&lt;T&gt;(
            this Result&lt;T&gt; result,
            Func&lt;T, Task&lt;bool&gt;&gt; predicate,
            string errorMessage)
        {
            if (result.IsFailure)
                return result;

            if (!await predicate(result.Value)
                     .ConfigureAwait(Result.DefaultConfigureAwait))
                return Result.Fail&lt;T&gt;(errorMessage);

            return result;
        }

        public static async Task&lt;Result&lt;T, E&gt;&gt; Ensure&lt;T, E&gt;(
            this Result&lt;T, E&gt; result,
            Func&lt;T, Task&lt;bool&gt;&gt; predicate,
            E error) where E : Exception
        {
            if (result.IsFailure)
                return result;

            if (!await predicate(result.Value)
                     .ConfigureAwait(Result.DefaultConfigureAwait))
                return Result.Fail&lt;T, E&gt;(error);

            return result;
        }

        public static async Task&lt;Result&gt; Ensure(this Result result, Func&lt;Task&lt;bool&gt;&gt; predicate, string errorMessage)
        {
            if (result.IsFailure)
                return result;

            if (!await predicate()
                     .ConfigureAwait(Result.DefaultConfigureAwait))
                return Result.Fail(errorMessage);

            return result;
        }

        public static Task&lt;Result&lt;K&gt;&gt; Map&lt;T, K&gt;(this Result&lt;T&gt; result, Func&lt;T, Task&lt;K&gt;&gt; func) =&gt; result.OnSuccess(func);

        public static Task&lt;Result&lt;K, E&gt;&gt; Map&lt;T, K, E&gt;(this Result&lt;T, E&gt; result, Func&lt;T, Task&lt;K&gt;&gt; func)
            where E : Exception =&gt;
            result.OnSuccess(func);

        public static Task&lt;Result&lt;T&gt;&gt; Map&lt;T&gt;(this Result result, Func&lt;Task&lt;T&gt;&gt; func) =&gt; result.OnSuccess(func);

        public static async Task&lt;Result&lt;T&gt;&gt; OnSuccess&lt;T&gt;(this Result&lt;T&gt; result, Func&lt;T, Task&gt; action)
        {
            if (result.IsSuccess)
                await action(result.Value)
                    .ConfigureAwait(Result.DefaultConfigureAwait);

            return result;
        }

        public static async Task&lt;Result&lt;T, E&gt;&gt; OnSuccess&lt;T, E&gt;(this Result&lt;T, E&gt; result, Func&lt;T, Task&gt; action) where E : Exception
        {
            if (result.IsSuccess)
                await action(result.Value)
                    .ConfigureAwait(Result.DefaultConfigureAwait);

            return result;
        }

        public static async Task&lt;Result&gt; OnSuccess(this Result result, Func&lt;Task&gt; action)
        {
            if (result.IsSuccess)
                await action()
                    .ConfigureAwait(Result.DefaultConfigureAwait);

            return result;
        }

        public static async Task&lt;T&gt; OnBoth&lt;T&gt;(this Result result, Func&lt;Result, Task&lt;T&gt;&gt; func) =&gt;
            await func(result)
                .ConfigureAwait(Result.DefaultConfigureAwait);

        public static async Task&lt;K&gt; OnBoth&lt;T, K&gt;(this Result&lt;T&gt; result, Func&lt;Result&lt;T&gt;, Task&lt;K&gt;&gt; func) =&gt;
            await func(result)
                .ConfigureAwait(Result.DefaultConfigureAwait);

        public static async Task&lt;K&gt; OnBoth&lt;T, K, E&gt;(this Result&lt;T, E&gt; result, Func&lt;Result&lt;T&gt;, Task&lt;K&gt;&gt; func) where E : Exception =&gt;
            await func(result)
                .ConfigureAwait(Result.DefaultConfigureAwait);

        public static async Task&lt;Result&lt;T&gt;&gt; OnFailure&lt;T&gt;(this Result&lt;T&gt; result, Func&lt;Task&gt; func)
        {
            if (result.IsFailure)
                await func()
                    .ConfigureAwait(Result.DefaultConfigureAwait);

            return result;
        }

        public static async Task&lt;Result&lt;T, E&gt;&gt; OnFailure&lt;T, E&gt;(this Result&lt;T, E&gt; result, Func&lt;Task&gt; func) where E : Exception
        {
            if (result.IsFailure)
                await func()
                    .ConfigureAwait(Result.DefaultConfigureAwait);

            return result;
        }

        public static async Task&lt;Result&gt; OnFailure(this Result result, Func&lt;Task&gt; func)
        {
            if (result.IsFailure)
                await func()
                    .ConfigureAwait(Result.DefaultConfigureAwait);

            return result;
        }

        public static async Task&lt;Result&lt;T&gt;&gt; OnFailure&lt;T&gt;(this Result&lt;T&gt; result, Func&lt;string, Task&gt; func)
        {
            if (result.IsFailure)
                await func(result.Error)
                    .ConfigureAwait(Result.DefaultConfigureAwait);

            return result;
        }

        public static async Task&lt;Result&lt;T, E&gt;&gt; OnFailure&lt;T, E&gt;(this Result&lt;T, E&gt; result, Func&lt;E, Task&gt; func) where E : Exception
        {
            if (result.IsFailure)
                await func(result.Error)
                    .ConfigureAwait(Result.DefaultConfigureAwait);

            return result;
        }

        public static async Task&lt;Result&lt;T&gt;&gt; OnFailureCompensate&lt;T&gt;(this Result&lt;T&gt; result, Func&lt;Task&lt;Result&lt;T&gt;&gt;&gt; func)
        {
            if (result.IsFailure)
                return await func()
                           .ConfigureAwait(Result.DefaultConfigureAwait);

            return result;
        }

        public static async Task&lt;Result&lt;T, E&gt;&gt; OnFailureCompensate&lt;T, E&gt;(
            this Result&lt;T, E&gt; result,
            Func&lt;Task&lt;Result&lt;T, E&gt;&gt;&gt; func) where E : Exception
        {
            if (result.IsFailure)
                return await func()
                           .ConfigureAwait(Result.DefaultConfigureAwait);

            return result;
        }

        public static async Task&lt;Result&gt; OnFailureCompensate(this Result result, Func&lt;Task&lt;Result&gt;&gt; func)
        {
            if (result.IsFailure)
                return await func()
                           .ConfigureAwait(Result.DefaultConfigureAwait);

            return result;
        }

        public static async Task&lt;Result&lt;T&gt;&gt; OnFailureCompensate&lt;T&gt;(
            this Result&lt;T&gt; result,
            Func&lt;string, Task&lt;Result&lt;T&gt;&gt;&gt; func)
        {
            if (result.IsFailure)
                return await func(result.Error)
                           .ConfigureAwait(Result.DefaultConfigureAwait);

            return result;
        }

        public static async Task&lt;Result&lt;T, E&gt;&gt; OnFailureCompensate&lt;T, E&gt;(
            this Result&lt;T, E&gt; result,
            Func&lt;E, Task&lt;Result&lt;T, E&gt;&gt;&gt; func) where E : Exception
        {
            if (result.IsFailure)
                return await func(result.Error)
                           .ConfigureAwait(Result.DefaultConfigureAwait);

            return result;
        }

        public static async Task&lt;Result&gt; Combine(this IEnumerable&lt;Task&lt;Result&gt;&gt; tasks, string errorMessageSeparator)
        {
#if NET40
            Result[] results = await TaskEx.WhenAll(tasks).ConfigureAwait(Result.DefaultConfigureAwait);
#else
            var results = await Task.WhenAll(tasks)
                                    .ConfigureAwait(Result.DefaultConfigureAwait);
#endif
            return results.Combine(errorMessageSeparator);
        }

        public static async Task&lt;Result&lt;IEnumerable&lt;T&gt;&gt;&gt; Combine&lt;T&gt;(
            this IEnumerable&lt;Task&lt;Result&lt;T&gt;&gt;&gt; tasks,
            string errorMessageSeparator)
        {
#if NET40
            Result&lt;T&gt;[] results = await TaskEx.WhenAll(tasks).ConfigureAwait(Result.DefaultConfigureAwait);
#else
            var results = await Task.WhenAll(tasks)
                                    .ConfigureAwait(Result.DefaultConfigureAwait);
#endif
            return results.Combine(errorMessageSeparator);
        }

        public static async Task&lt;Result&gt; Combine(this Task&lt;IEnumerable&lt;Result&gt;&gt; task, string errorMessageSeparator)
        {
            var results = await task.ConfigureAwait(Result.DefaultConfigureAwait);
            return results.Combine(errorMessageSeparator);
        }

        public static async Task&lt;Result&lt;IEnumerable&lt;T&gt;&gt;&gt; Combine&lt;T&gt;(
            this Task&lt;IEnumerable&lt;Result&lt;T&gt;&gt;&gt; task,
            string errorMessageSeparator)
        {
            var results = await task.ConfigureAwait(Result.DefaultConfigureAwait);
            return results.Combine(errorMessageSeparator);
        }

        public static async Task&lt;Result&gt; Combine(
            this Task&lt;IEnumerable&lt;Task&lt;Result&gt;&gt;&gt; task,
            string errorMessageSeparator)
        {
            var tasks = await task.ConfigureAwait(Result.DefaultConfigureAwait);

#if NET40
            var results = await TaskEx.WhenAll(tasks).ConfigureAwait(Result.DefaultConfigureAwait);
#else
            var results = await Task.WhenAll(tasks)
                                    .ConfigureAwait(Result.DefaultConfigureAwait);
#endif

            return results.Combine(errorMessageSeparator);
        }

        public static async Task&lt;Result&lt;IEnumerable&lt;T&gt;&gt;&gt; Combine&lt;T&gt;(
            this Task&lt;IEnumerable&lt;Task&lt;Result&lt;T&gt;&gt;&gt;&gt; task,
            string errorMessageSeparator)
        {
            var tasks = await task.ConfigureAwait(Result.DefaultConfigureAwait);
#if NET40
            var results = await TaskEx.WhenAll(tasks).ConfigureAwait(Result.DefaultConfigureAwait);
#else
            var results = await Task.WhenAll(tasks)
                                    .ConfigureAwait(Result.DefaultConfigureAwait);
#endif

            return results.Combine(errorMessageSeparator);
        }

        public static async Task&lt;Result&lt;K&gt;&gt; Combine&lt;T, K&gt;(
            this IEnumerable&lt;Task&lt;Result&lt;T&gt;&gt;&gt; tasks,
            Func&lt;IEnumerable&lt;T&gt;, K&gt; composer,
            string errorMessageSeparator)
        {
#if NET40
            IEnumerable&lt;Result&lt;T&gt;&gt; results = await TaskEx.WhenAll(tasks).ConfigureAwait(Result.DefaultConfigureAwait);
#else
            IEnumerable&lt;Result&lt;T&gt;&gt; results = await Task.WhenAll(tasks)
                                                       .ConfigureAwait(Result.DefaultConfigureAwait);
#endif

            return results.Combine(composer, errorMessageSeparator);
        }

        public static async Task&lt;Result&lt;K&gt;&gt; Combine&lt;T, K&gt;(
            this Task&lt;IEnumerable&lt;Task&lt;Result&lt;T&gt;&gt;&gt;&gt; task,
            Func&lt;IEnumerable&lt;T&gt;, K&gt; composer,
            string errorMessageSeparator)
        {
            var tasks = await task.ConfigureAwait(Result.DefaultConfigureAwait);
            return await tasks.Combine(composer, errorMessageSeparator)
                              .ConfigureAwait(Result.DefaultConfigureAwait);
        }

        public static async Task&lt;Result&gt; OnSuccessTry(
            this Task&lt;Result&gt; task,
            Action action,
            Func&lt;Exception, string&gt; errorHandler = null)
        {
            var result = await task.ConfigureAwait(Result.DefaultConfigureAwait);
            return result.OnSuccessTry(action, errorHandler);
        }

        public static async Task&lt;Result&lt;T&gt;&gt; OnSuccessTry&lt;T&gt;(
            this Task&lt;Result&gt; task,
            Func&lt;T&gt; func,
            Func&lt;Exception, string&gt; errorHandler = null)
        {
            var result = await task.ConfigureAwait(Result.DefaultConfigureAwait);
            return result.OnSuccessTry(func, errorHandler);
        }

        public static async Task&lt;Result&gt; OnSuccessTry&lt;T&gt;(
            this Task&lt;Result&lt;T&gt;&gt; task,
            Action&lt;T&gt; action,
            Func&lt;Exception, string&gt; errorHandler = null)
        {
            var result = await task.ConfigureAwait(Result.DefaultConfigureAwait);
            return result.OnSuccessTry(action, errorHandler);
        }

        public static async Task&lt;Result&lt;K&gt;&gt; OnSuccessTry&lt;T, K&gt;(
            this Task&lt;Result&lt;T&gt;&gt; task,
            Func&lt;T, K&gt; action,
            Func&lt;Exception, string&gt; errorHandler = null)
        {
            var result = await task.ConfigureAwait(Result.DefaultConfigureAwait);
            return result.OnSuccessTry(action, errorHandler);
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[13,9,13,10,0],[14,13,14,34,0],[15,17,15,53,0],[17,13,18,75,0],[20,13,20,37,0],[21,9,21,10,0],[25,9,25,10,0],[26,13,26,34,0],[27,17,27,56,0],[29,13,30,75,0],[32,13,32,43,0],[33,9,33,10,0],[36,9,36,10,0],[37,13,37,34,0],[38,17,38,53,0],[40,13,41,75,0],[43,13,43,37,0],[44,9,44,10,0],[47,9,47,10,0],[48,13,48,34,0],[49,17,49,53,0],[51,13,52,70,0],[53,9,53,10,0],[58,9,58,10,0],[59,13,59,34,0],[60,17,60,56,0],[62,13,63,70,0],[64,9,64,10,0],[67,9,67,10,0],[68,13,68,34,0],[69,17,69,53,0],[71,13,72,70,0],[73,9,73,10,0],[76,9,76,10,0],[77,13,77,34,0],[78,17,78,53,0],[80,13,81,70,0],[82,9,82,10,0],[87,9,87,10,0],[88,13,88,34,0],[89,17,89,56,0],[91,13,92,70,0],[93,9,93,10,0],[96,9,96,10,0],[97,13,97,34,0],[98,17,98,50,0],[100,13,101,70,0],[102,9,102,10,0],[105,9,105,10,0],[106,13,106,34,0],[107,17,107,31,0],[109,13,110,70,0],[111,9,111,10,0],[117,9,117,10,0],[118,13,118,34,0],[119,17,119,31,0],[121,13,122,68,0],[123,17,123,53,0],[125,13,125,27,0],[126,9,126,10,0],[132,9,132,10,0],[133,13,133,34,0],[134,17,134,31,0],[136,13,137,68,0],[138,17,138,49,0],[140,13,140,27,0],[141,9,141,10,0],[144,9,144,10,0],[145,13,145,34,0],[146,17,146,31,0],[148,13,149,68,0],[150,17,150,50,0],[152,13,152,27,0],[153,9,153,10,0],[155,98,155,120,0],[159,13,159,35,0],[161,89,161,111,0],[164,9,164,10,0],[165,13,165,34,0],[166,17,167,67,0],[169,13,169,27,0],[170,9,170,10,0],[173,9,173,10,0],[174,13,174,34,0],[175,17,176,67,0],[178,13,178,27,0],[179,9,179,10,0],[182,9,182,10,0],[183,13,183,34,0],[184,17,185,67,0],[187,13,187,27,0],[188,9,188,10,0],[191,13,192,62,0],[195,13,196,62,0],[199,13,200,62,0],[203,9,203,10,0],[204,13,204,34,0],[205,17,206,67,0],[208,13,208,27,0],[209,9,209,10,0],[212,9,212,10,0],[213,13,213,34,0],[214,17,215,67,0],[217,13,217,27,0],[218,9,218,10,0],[221,9,221,10,0],[222,13,222,34,0],[223,17,224,67,0],[226,13,226,27,0],[227,9,227,10,0],[230,9,230,10,0],[231,13,231,34,0],[232,17,233,67,0],[235,13,235,27,0],[236,9,236,10,0],[239,9,239,10,0],[240,13,240,34,0],[241,17,242,67,0],[244,13,244,27,0],[245,9,245,10,0],[248,9,248,10,0],[249,13,249,34,0],[250,17,251,74,0],[253,13,253,27,0],[254,9,254,10,0],[259,9,259,10,0],[260,13,260,34,0],[261,17,262,74,0],[264,13,264,27,0],[265,9,265,10,0],[268,9,268,10,0],[269,13,269,34,0],[270,17,271,74,0],[273,13,273,27,0],[274,9,274,10,0],[279,9,279,10,0],[280,13,280,34,0],[281,17,282,74,0],[284,13,284,27,0],[285,9,285,10,0],[290,9,290,10,0],[291,13,291,34,0],[292,17,293,74,0],[295,13,295,27,0],[296,9,296,10,0],[299,9,299,10,0],[303,13,304,83,0],[306,13,306,59,0],[307,9,307,10,0],[312,9,312,10,0],[316,13,317,83,0],[319,13,319,59,0],[320,9,320,10,0],[323,9,323,10,0],[324,13,324,83,0],[325,13,325,59,0],[326,9,326,10,0],[331,9,331,10,0],[332,13,332,83,0],[333,13,333,59,0],[334,9,334,10,0],[339,9,339,10,0],[340,13,340,81,0],[345,13,346,83,0],[349,13,349,59,0],[350,9,350,10,0],[355,9,355,10,0],[356,13,356,81,0],[360,13,361,83,0],[364,13,364,59,0],[365,9,365,10,0],[371,9,371,10,0],[375,13,376,102,0],[379,13,379,69,0],[380,9,380,10,0],[386,9,386,10,0],[387,13,387,81,0],[388,13,389,77,0],[390,9,390,10,0],[396,9,396,10,0],[397,13,397,82,0],[398,13,398,62,0],[399,9,399,10,0],[405,9,405,10,0],[406,13,406,82,0],[407,13,407,60,0],[408,9,408,10,0],[414,9,414,10,0],[415,13,415,82,0],[416,13,416,62,0],[417,9,417,10,0],[423,9,423,10,0],[424,13,424,82,0],[425,13,425,62,0],[426,9,426,10,0]]);
    </script>
  </body>
</html>