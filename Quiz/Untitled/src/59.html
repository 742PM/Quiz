<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>e:\users\funfine\source\quiz\quiz\infrastructure\result\resultextensions.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;

namespace Infrastructure.Result
{
    public static class ResultExtensions
    {
        public static Result&lt;TK, TE&gt; OnSuccess&lt;T, TK, TE&gt;(this Result&lt;T, TE&gt; result, Func&lt;T, TK&gt; func) where TE : Exception
        {
            if (result.IsFailure)
                return Result.Fail&lt;TK, TE&gt;(result.Error);

            return Result.Ok&lt;TK, TE&gt;(func(result.Value));
        }

        public static Result&lt;TK&gt; OnSuccess&lt;T, TK&gt;(this Result&lt;T&gt; result, Func&lt;T, TK&gt; func)
        {
            if (result.IsFailure)
                return Result.Fail&lt;TK&gt;(result.Error);

            return Result.Ok(func(result.Value));
        }

        public static Result&lt;T&gt; OnSuccess&lt;T&gt;(this Result result, Func&lt;T&gt; func)
        {
            if (result.IsFailure)
                return Result.Fail&lt;T&gt;(result.Error);

            return Result.Ok(func());
        }

        public static Result&lt;TK, TE&gt; OnSuccess&lt;T, TK, TE&gt;(this Result&lt;T, TE&gt; result, Func&lt;T, Result&lt;TK, TE&gt;&gt; func)
            where TE : Exception
        {
            if (result.IsFailure)
                return Result.Fail&lt;TK, TE&gt;(result.Error);

            return func(result.Value);
        }

        public static Result&lt;TK&gt; OnSuccess&lt;T, TK&gt;(this Result&lt;T&gt; result, Func&lt;T, Result&lt;TK&gt;&gt; func)
        {
            if (result.IsFailure)
                return Result.Fail&lt;TK&gt;(result.Error);

            return func(result.Value);
        }

        public static Result&lt;T&gt; OnSuccess&lt;T&gt;(this Result result, Func&lt;Result&lt;T&gt;&gt; func)
        {
            if (result.IsFailure)
                return Result.Fail&lt;T&gt;(result.Error);

            return func();
        }

        public static Result&lt;TK, TE&gt; OnSuccess&lt;T, TK, TE&gt;(this Result&lt;T, TE&gt; result, Func&lt;Result&lt;TK, TE&gt;&gt; func) where TE : Exception
        {
            if (result.IsFailure)
                return Result.Fail&lt;TK, TE&gt;(result.Error);

            return func();
        }

        public static Result&lt;TK&gt; OnSuccess&lt;T, TK&gt;(this Result&lt;T&gt; result, Func&lt;Result&lt;TK&gt;&gt; func)
        {
            if (result.IsFailure)
                return Result.Fail&lt;TK&gt;(result.Error);

            return func();
        }

        public static Result&lt;TK&gt; OnSuccess&lt;T, TK, TE&gt;(this Result&lt;T, TE&gt; result, Func&lt;T, Result&lt;TK&gt;&gt; func) where TE : Exception
        {
            if (result.IsFailure)
                return Result.Fail&lt;TK, TE&gt;(result.Error);

            return func(result.Value);
        }

        public static Result OnSuccess&lt;T, TK, TE&gt;(this Result&lt;T, TE&gt; result, Func&lt;T, Result&gt; func) where TE : Exception
        {
            if (result.IsFailure)
                return Result.Fail&lt;TK, TE&gt;(result.Error);

            return func(result.Value);
        }

        public static Result OnSuccess&lt;T&gt;(this Result&lt;T&gt; result, Func&lt;T, Result&gt; func)
        {
            if (result.IsFailure)
                return Result.Fail(result.Error);

            return func(result.Value);
        }

        public static Result OnSuccess(this Result result, Func&lt;Result&gt; func)
        {
            if (result.IsFailure)
                return result;

            return func();
        }

        public static Result&lt;T, TE&gt; Ensure&lt;T, TE&gt;(this Result&lt;T, TE&gt; result, Func&lt;T, bool&gt; predicate, TE error)
            where TE : Exception
        {
            if (result.IsFailure)
                return result;

            if (!predicate(result.Value))
                return Result.Fail&lt;T, TE&gt;(error);

            return result;
        }

        public static Result&lt;T&gt; Ensure&lt;T&gt;(this Result&lt;T&gt; result, Func&lt;T, bool&gt; predicate, string errorMessage)
        {
            if (result.IsFailure)
                return result;

            if (!predicate(result.Value))
                return Result.Fail&lt;T&gt;(errorMessage);

            return result;
        }

        public static Result Ensure(this Result result, Func&lt;bool&gt; predicate, string errorMessage)
        {
            if (result.IsFailure)
                return result;

            if (!predicate())
                return Result.Fail(errorMessage);

            return result;
        }

        public static Result&lt;TK, TE&gt; Map&lt;T, TK, TE&gt;(
            this Result&lt;T, TE&gt; result,
            Func&lt;T, TK&gt; onSuccess,
            Func&lt;TE, TK&gt; onFailure) where TE : Exception
        {
            var (isSuccess, _, value, error) = result;
            return isSuccess ? onSuccess(value) : onFailure(error);
        }



        public static Result&lt;TK, TE&gt; Map&lt;T, TK, TE&gt;(this Result&lt;T, TE&gt; result, Func&lt;T, TK&gt; func) where TE : Exception =&gt;
            result.OnSuccess(func);

        public static Result&lt;TK&gt; Map&lt;T, TK&gt;(this Result&lt;T&gt; result, Func&lt;T, TK&gt; func) =&gt; result.OnSuccess(func);

        public static Result&lt;T&gt; Map&lt;T&gt;(this Result result, Func&lt;T&gt; func) =&gt; result.OnSuccess(func);

        public static Result&lt;T, TE&gt; OnSuccess&lt;T, TE&gt;(this Result&lt;T, TE&gt; result, Action&lt;T&gt; action) where TE : Exception
        {
            if (result.IsSuccess) action(result.Value);

            return result;
        }

        public static Result&lt;T&gt; OnSuccess&lt;T&gt;(this Result&lt;T&gt; result, Action&lt;T&gt; action)
        {
            if (result.IsSuccess) action(result.Value);

            return result;
        }

        public static Result OnSuccess(this Result result, Action action)
        {
            if (result.IsSuccess) action();

            return result;
        }

        public static Result OnSuccessTry(
            this Result result,
            Action action,
            Func&lt;Exception, string&gt; errorHandler = null) =&gt;
            result.IsFailure ? result : Result.Try(action, errorHandler);

        public static Result&lt;T&gt; OnSuccessTry&lt;T&gt;(
            this Result result,
            Func&lt;T&gt; func,
            Func&lt;Exception, string&gt; errorHandler = null) =&gt;
            result.IsFailure ? Result.Fail&lt;T&gt;(result.Error) : Result.Try(func, errorHandler);

        public static Result OnSuccessTry&lt;T&gt;(
            this Result&lt;T&gt; result,
            Action&lt;T&gt; action,
            Func&lt;Exception, string&gt; errorHandler = null)
        {
            return result.IsFailure ? Result.Fail(result.Error) : Result.Try(() =&gt; action(result.Value), errorHandler);
        }

        public static Result&lt;TK&gt; OnSuccessTry&lt;T, TK&gt;(
            this Result&lt;T&gt; result,
            Func&lt;T, TK&gt; func,
            Func&lt;Exception, string&gt; errorHandler = null)
        {
            return result.IsFailure ? Result.Fail&lt;TK&gt;(result.Error) : Result.Try(() =&gt; func(result.Value), errorHandler);
        }

        public static T OnBoth&lt;T&gt;(this Result result, Func&lt;Result, T&gt; func) =&gt; func(result);

        public static TK OnBoth&lt;T, TK&gt;(this Result&lt;T&gt; result, Func&lt;Result&lt;T&gt;, TK&gt; func) =&gt; func(result);

        public static TK OnBoth&lt;T, TK, TE&gt;(this Result&lt;T, TE&gt; result, Func&lt;Result&lt;T, TE&gt;, TK&gt; func) where TE : Exception =&gt; func(result);

        public static T OnBoth&lt;T, TE&gt;(this Result&lt;T, TE&gt; result, Func&lt;Result&lt;T, TE&gt;, T&gt; func) where TE : Exception =&gt;
            func(result);

        public static Result&lt;T, TE&gt; OnFailure&lt;T, TE&gt;(this Result&lt;T, TE&gt; result, Func&lt;TE, T&gt; compensator) where TE : Exception
        {
            if (result.IsFailure)
                return compensator(result.Error);

            return result;
        }

        public static Result&lt;T, TE&gt; OnFailure&lt;T, TE&gt;(this Result&lt;T, TE&gt; result, Func&lt;TE, Result&lt;T, TE&gt;&gt; action)
            where TE : Exception
        {
            if (result.IsFailure)
                return action(result.Error);

            return result;
        }

        public static Result&lt;TK, TE&gt; OnFailure&lt;T, TE, TK&gt;(this Result&lt;T, TE&gt; result, Func&lt;TE, Result&lt;TK, TE&gt;&gt; action)
            where TE : Exception where TK : class
        {
            if (result.IsFailure)
                return action(result.Error);

            return result.Value as TK ?? throw new InvalidCastException();
        }

        public static Result&lt;TK, TE&gt; OnFailure&lt;T, TE, TK&gt;(this Result&lt;T, TE&gt; result, Func&lt;TE, TK&gt; action)
            where TE : Exception where TK : class
        {
            if (result.IsFailure)
                return action(result.Error);

            return result.Value as TK ?? throw new InvalidCastException();
        }

        public static Result&lt;T&gt; OnFailure&lt;T&gt;(this Result&lt;T&gt; result, Action&lt;string&gt; action)
        {
            if (result.IsFailure) action(result.Error);

            return result;
        }

        public static Result OnFailure(this Result result, Action&lt;string&gt; action)
        {
            if (result.IsFailure)
                action(result.Error);

            return result;
        }

        public static Result&lt;T, TE&gt; OnFailureCompensate&lt;T, TE&gt;(this Result&lt;T, TE&gt; result, Func&lt;Result&lt;T, TE&gt;&gt; func)
            where TE : Exception
        {
            if (result.IsFailure)
                return func();

            return result;
        }

        public static Result&lt;T&gt; OnFailureCompensate&lt;T&gt;(this Result&lt;T&gt; result, Func&lt;Result&lt;T&gt;&gt; func)
        {
            if (result.IsFailure)
                return func();

            return result;
        }

        public static Result OnFailureCompensate(this Result result, Func&lt;Result&gt; func)
        {
            if (result.IsFailure)
                return func();

            return result;
        }

        public static Result&lt;T, TE&gt; OnFailureCompensate&lt;T, TE&gt;(this Result&lt;T, TE&gt; result, Func&lt;TE, Result&lt;T, TE&gt;&gt; func)
            where TE : Exception
        {
            if (result.IsFailure)
                return func(result.Error);

            return result;
        }

        public static Result&lt;T&gt; OnFailureCompensate&lt;T&gt;(this Result&lt;T&gt; result, Func&lt;string, Result&lt;T&gt;&gt; func)
        {
            if (result.IsFailure)
                return func(result.Error);

            return result;
        }

        public static Result OnFailureCompensate(this Result result, Func&lt;string, Result&gt; func)
        {
            if (result.IsFailure)
                return func(result.Error);

            return result;
        }

        public static Result Combine(this IEnumerable&lt;Result&gt; results, string errorMessagesSeparator) =&gt;
            Result.Combine(errorMessagesSeparator, results as Result[] ?? results.ToArray());

        public static Result Combine(this IEnumerable&lt;Result&gt; results) =&gt;
            Result.Combine(results as Result[] ?? results.ToArray());

        public static Result&lt;IEnumerable&lt;T&gt;&gt; Combine&lt;T&gt;(
            this IEnumerable&lt;Result&lt;T&gt;&gt; results,
            string errorMessagesSeparator)
        {
            var data = results as Result&lt;T&gt;[] ?? results.ToArray();

            var result = Result.Combine(errorMessagesSeparator, data);

            return result.IsSuccess ? Result.Ok(data.Select(e =&gt; e.Value)) : Result.Fail&lt;IEnumerable&lt;T&gt;&gt;(result.Error);
        }

        public static Result&lt;TK&gt; Combine&lt;T, TK&gt;(
            this IEnumerable&lt;Result&lt;T&gt;&gt; results,
            Func&lt;IEnumerable&lt;T&gt;, TK&gt; composer,
            string errorMessageSeparator)
        {
            var result = results.Combine(errorMessageSeparator);

            return result.IsSuccess ? Result.Ok(composer(result.Value)) : Result.Fail&lt;TK&gt;(result.Error);
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[10,9,10,10,0],[11,13,11,34,0],[12,17,12,58,0],[14,13,14,58,0],[15,9,15,10,0],[18,9,18,10,0],[19,13,19,34,0],[20,17,20,54,0],[22,13,22,50,0],[23,9,23,10,0],[26,9,26,10,0],[27,13,27,34,0],[28,17,28,53,0],[30,13,30,38,0],[31,9,31,10,0],[35,9,35,10,0],[36,13,36,34,0],[37,17,37,58,0],[39,13,39,39,0],[40,9,40,10,0],[43,9,43,10,0],[44,13,44,34,0],[45,17,45,54,0],[47,13,47,39,0],[48,9,48,10,0],[51,9,51,10,0],[52,13,52,34,0],[53,17,53,53,0],[55,13,55,27,0],[56,9,56,10,0],[59,9,59,10,0],[60,13,60,34,0],[61,17,61,58,0],[63,13,63,27,0],[64,9,64,10,0],[67,9,67,10,0],[68,13,68,34,0],[69,17,69,54,0],[71,13,71,27,0],[72,9,72,10,0],[75,9,75,10,0],[76,13,76,34,0],[77,17,77,58,0],[79,13,79,39,0],[80,9,80,10,0],[83,9,83,10,0],[84,13,84,34,0],[85,17,85,58,0],[87,13,87,39,0],[88,9,88,10,0],[91,9,91,10,0],[92,13,92,34,0],[93,17,93,50,0],[95,13,95,39,0],[96,9,96,10,0],[99,9,99,10,0],[100,13,100,34,0],[101,17,101,31,0],[103,13,103,27,0],[104,9,104,10,0],[108,9,108,10,0],[109,13,109,34,0],[110,17,110,31,0],[112,13,112,42,0],[113,17,113,50,0],[115,13,115,27,0],[116,9,116,10,0],[119,9,119,10,0],[120,13,120,34,0],[121,17,121,31,0],[123,13,123,42,0],[124,17,124,53,0],[126,13,126,27,0],[127,9,127,10,0],[130,9,130,10,0],[131,13,131,34,0],[132,17,132,31,0],[134,13,134,30,0],[135,17,135,50,0],[137,13,137,27,0],[138,9,138,10,0],[144,9,144,10,0],[145,13,145,55,0],[146,13,146,68,0],[147,9,147,10,0],[152,13,152,35,0],[154,89,154,111,0],[156,77,156,99,0],[159,9,159,10,0],[160,13,160,34,0],[160,35,160,56,0],[162,13,162,27,0],[163,9,163,10,0],[166,9,166,10,0],[167,13,167,34,0],[167,35,167,56,0],[169,13,169,27,0],[170,9,170,10,0],[173,9,173,10,0],[174,13,174,34,0],[174,35,174,44,0],[176,13,176,27,0],[177,9,177,10,0],[183,13,183,73,0],[189,13,189,93,0],[195,9,195,10,0],[196,13,196,84,0],[196,84,196,104,0],[196,104,196,120,0],[196,13,196,120,0],[197,9,197,10,0],[203,9,203,10,0],[204,13,204,88,0],[204,88,204,106,0],[204,106,204,122,0],[204,13,204,122,0],[205,9,205,10,0],[207,80,207,92,0],[209,92,209,104,0],[211,125,211,137,0],[214,13,214,25,0],[217,9,217,10,0],[218,13,218,34,0],[219,17,219,50,0],[221,13,221,27,0],[222,9,222,10,0],[226,9,226,10,0],[227,13,227,34,0],[228,17,228,45,0],[230,13,230,27,0],[231,9,231,10,0],[235,9,235,10,0],[236,13,236,34,0],[237,17,237,45,0],[239,13,239,75,0],[240,9,240,10,0],[244,9,244,10,0],[245,13,245,34,0],[246,17,246,45,0],[248,13,248,75,0],[249,9,249,10,0],[252,9,252,10,0],[253,13,253,34,0],[253,35,253,56,0],[255,13,255,27,0],[256,9,256,10,0],[259,9,259,10,0],[260,13,260,34,0],[261,17,261,38,0],[263,13,263,27,0],[264,9,264,10,0],[268,9,268,10,0],[269,13,269,34,0],[270,17,270,31,0],[272,13,272,27,0],[273,9,273,10,0],[276,9,276,10,0],[277,13,277,34,0],[278,17,278,31,0],[280,13,280,27,0],[281,9,281,10,0],[284,9,284,10,0],[285,13,285,34,0],[286,17,286,31,0],[288,13,288,27,0],[289,9,289,10,0],[293,9,293,10,0],[294,13,294,34,0],[295,17,295,43,0],[297,13,297,27,0],[298,9,298,10,0],[301,9,301,10,0],[302,13,302,34,0],[303,17,303,43,0],[305,13,305,27,0],[306,9,306,10,0],[309,9,309,10,0],[310,13,310,34,0],[311,17,311,43,0],[313,13,313,27,0],[314,9,314,10,0],[317,13,317,93,0],[320,13,320,69,0],[325,9,325,10,0],[326,13,326,68,0],[328,13,328,71,0],[330,13,330,66,0],[330,66,330,73,0],[330,73,330,120,0],[330,13,330,120,0],[331,9,331,10,0],[337,9,337,10,0],[338,13,338,65,0],[340,13,340,105,0],[341,9,341,10,0]]);
    </script>
  </body>
</html>